c3dd96ce9a66b33287a474fde712cf3a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _require = require('react-native'),
    NativeModules = _require.NativeModules;

var RCTAsyncStorage = NativeModules.RNC_AsyncSQLiteDBStorage || NativeModules.RNCAsyncStorage || NativeModules.PlatformLocalStorage;

if (!RCTAsyncStorage) {
  throw new Error("[@RNC/AsyncStorage]: NativeModule: AsyncStorage is null.\n\nTo fix this issue try these steps:\n\n  \u2022 Run `react-native link @react-native-community/async-storage` in the project root.\n\n  \u2022 Rebuild and restart the app.\n\n  \u2022 Run the packager with `--clearCache` flag.\n\n  \u2022 If you are using CocoaPods on iOS, run `pod install` in the `ios` directory and then rebuild and re-run the app.\n\n  \u2022 If this happens while testing with Jest, check out docs how to integrate AsyncStorage with it: https://github.com/react-native-community/async-storage/blob/LEGACY/docs/Jest-integration.md\n\nIf none of these fix the issue, please open an issue on the Github repository: https://github.com/react-native-community/react-native-async-storage/issues \n");
}

var AsyncStorage = {
  _getRequests: [],
  _getKeys: [],
  _immediate: null,
  getItem: function getItem(key, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiGet([key], function (errors, result) {
        var value = result && result[0] && result[0][1] ? result[0][1] : null;
        var errs = convertErrors(errors);
        callback && callback(errs && errs[0], value);

        if (errs) {
          reject(errs[0]);
        } else {
          resolve(value);
        }
      });
    });
  },
  setItem: function setItem(key, value, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiSet([[key, value]], function (errors) {
        var errs = convertErrors(errors);
        callback && callback(errs && errs[0]);

        if (errs) {
          reject(errs[0]);
        } else {
          resolve(null);
        }
      });
    });
  },
  removeItem: function removeItem(key, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiRemove([key], function (errors) {
        var errs = convertErrors(errors);
        callback && callback(errs && errs[0]);

        if (errs) {
          reject(errs[0]);
        } else {
          resolve(null);
        }
      });
    });
  },
  mergeItem: function mergeItem(key, value, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiMerge([[key, value]], function (errors) {
        var errs = convertErrors(errors);
        callback && callback(errs && errs[0]);

        if (errs) {
          reject(errs[0]);
        } else {
          resolve(null);
        }
      });
    });
  },
  clear: function clear(callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.clear(function (error) {
        var err = convertError(error);
        callback && callback(err);

        if (err) {
          reject(err);
        } else {
          resolve(null);
        }
      });
    });
  },
  getAllKeys: function getAllKeys(callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.getAllKeys(function (error, keys) {
        var err = convertError(error);
        callback && callback(err, keys);

        if (err) {
          reject(err);
        } else {
          resolve(keys);
        }
      });
    });
  },
  flushGetRequests: function flushGetRequests() {
    var getRequests = this._getRequests;
    var getKeys = this._getKeys;
    this._getRequests = [];
    this._getKeys = [];
    RCTAsyncStorage.multiGet(getKeys, function (errors, result) {
      var map = {};
      result && result.forEach(function (_ref) {
        var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
            key = _ref2[0],
            value = _ref2[1];

        map[key] = value;
        return value;
      });
      var reqLength = getRequests.length;

      for (var i = 0; i < reqLength; i++) {
        var request = getRequests[i];
        var requestKeys = request.keys;
        var requestResult = requestKeys.map(function (key) {
          return [key, map[key]];
        });
        request.callback && request.callback(null, requestResult);
        request.resolve && request.resolve(requestResult);
      }
    });
  },
  multiGet: function multiGet(keys, callback) {
    var _this = this;

    if (!this._immediate) {
      this._immediate = setImmediate(function () {
        _this._immediate = null;

        _this.flushGetRequests();
      });
    }

    var getRequest = {
      keys: keys,
      callback: callback,
      keyIndex: this._getKeys.length,
      resolve: null,
      reject: null
    };
    var promiseResult = new Promise(function (resolve, reject) {
      getRequest.resolve = resolve;
      getRequest.reject = reject;
    });

    this._getRequests.push(getRequest);

    keys.forEach(function (key) {
      if (_this._getKeys.indexOf(key) === -1) {
        _this._getKeys.push(key);
      }
    });
    return promiseResult;
  },
  multiSet: function multiSet(keyValuePairs, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiSet(keyValuePairs, function (errors) {
        var error = convertErrors(errors);
        callback && callback(error);

        if (error) {
          reject(error);
        } else {
          resolve(null);
        }
      });
    });
  },
  multiRemove: function multiRemove(keys, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiRemove(keys, function (errors) {
        var error = convertErrors(errors);
        callback && callback(error);

        if (error) {
          reject(error);
        } else {
          resolve(null);
        }
      });
    });
  },
  multiMerge: function multiMerge(keyValuePairs, callback) {
    return new Promise(function (resolve, reject) {
      RCTAsyncStorage.multiMerge(keyValuePairs, function (errors) {
        var error = convertErrors(errors);
        callback && callback(error);

        if (error) {
          reject(error);
        } else {
          resolve(null);
        }
      });
    });
  }
};

if (!RCTAsyncStorage.multiMerge) {
  delete AsyncStorage.mergeItem;
  delete AsyncStorage.multiMerge;
}

function convertErrors(errs) {
  if (!errs) {
    return null;
  }

  return (Array.isArray(errs) ? errs : [errs]).map(function (e) {
    return convertError(e);
  });
}

function convertError(error) {
  if (!error) {
    return null;
  }

  var out = new Error(error.message);
  out.key = error.key;
  return out;
}

var _default = AsyncStorage;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzeW5jU3RvcmFnZS5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiTmF0aXZlTW9kdWxlcyIsIlJDVEFzeW5jU3RvcmFnZSIsIlJOQ19Bc3luY1NRTGl0ZURCU3RvcmFnZSIsIlJOQ0FzeW5jU3RvcmFnZSIsIlBsYXRmb3JtTG9jYWxTdG9yYWdlIiwiRXJyb3IiLCJBc3luY1N0b3JhZ2UiLCJfZ2V0UmVxdWVzdHMiLCJfZ2V0S2V5cyIsIl9pbW1lZGlhdGUiLCJnZXRJdGVtIiwia2V5IiwiY2FsbGJhY2siLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm11bHRpR2V0IiwiZXJyb3JzIiwicmVzdWx0IiwidmFsdWUiLCJlcnJzIiwiY29udmVydEVycm9ycyIsInNldEl0ZW0iLCJtdWx0aVNldCIsInJlbW92ZUl0ZW0iLCJtdWx0aVJlbW92ZSIsIm1lcmdlSXRlbSIsIm11bHRpTWVyZ2UiLCJjbGVhciIsImVycm9yIiwiZXJyIiwiY29udmVydEVycm9yIiwiZ2V0QWxsS2V5cyIsImtleXMiLCJmbHVzaEdldFJlcXVlc3RzIiwiZ2V0UmVxdWVzdHMiLCJnZXRLZXlzIiwibWFwIiwiZm9yRWFjaCIsInJlcUxlbmd0aCIsImxlbmd0aCIsImkiLCJyZXF1ZXN0IiwicmVxdWVzdEtleXMiLCJyZXF1ZXN0UmVzdWx0Iiwic2V0SW1tZWRpYXRlIiwiZ2V0UmVxdWVzdCIsImtleUluZGV4IiwicHJvbWlzZVJlc3VsdCIsInB1c2giLCJpbmRleE9mIiwia2V5VmFsdWVQYWlycyIsIkFycmF5IiwiaXNBcnJheSIsImUiLCJvdXQiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiQUFXQTs7Ozs7Ozs7Ozs7ZUFFd0JBLE9BQU8sQ0FBQyxjQUFELEM7SUFBeEJDLGEsWUFBQUEsYTs7QUFFUCxJQUFNQyxlQUFlLEdBQ25CRCxhQUFhLENBQUNFLHdCQUFkLElBQ0FGLGFBQWEsQ0FBQ0csZUFEZCxJQUVBSCxhQUFhLENBQUNJLG9CQUhoQjs7QUFLQSxJQUFJLENBQUNILGVBQUws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QyxLQUFLLENBQUNDLE9BQU4sQ0FBY2pDLElBQWQsSUFBc0JBLElBQXRCLEdBQTZCLENBQUNBLElBQUQsQ0FBOUIsRUFBc0NpQixHQUF0QyxDQUEwQyxVQUFBaUIsQ0FBQztBQUFBLFdBQUl2QixZQUFZLENBQUN1QixDQUFELENBQWhCO0FBQUEsR0FBM0MsQ0FBUDtBQUNEOztBQUVELFNBQVN2QixZQUFULENBQXNCRixLQUF0QixFQUFxQztBQUNuQyxNQUFJLENBQUNBLEtBQUwsRUFBWTtBQUNWLFdBQU8sSUFBUDtBQUNEOztBQUNELE1BQU0wQixHQUFHLEdBQUcsSUFBSWxELEtBQUosQ0FBVXdCLEtBQUssQ0FBQzJCLE9BQWhCLENBQVo7QUFFQUQsRUFBQUEsR0FBRyxDQUFDNUMsR0FBSixHQUFVa0IsS0FBSyxDQUFDbEIsR0FBaEI7QUFDQSxTQUFPNEMsR0FBUDtBQUNEOztlQUVjakQsWSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3dcbiAqIEBqc2RvY1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3Qge05hdGl2ZU1vZHVsZXN9ID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJyk7XG5cbmNvbnN0IFJDVEFzeW5jU3RvcmFnZSA9XG4gIE5hdGl2ZU1vZHVsZXMuUk5DX0FzeW5jU1FMaXRlREJTdG9yYWdlIHx8XG4gIE5hdGl2ZU1vZHVsZXMuUk5DQXN5bmNTdG9yYWdlIHx8XG4gIE5hdGl2ZU1vZHVsZXMuUGxhdGZvcm1Mb2NhbFN0b3JhZ2U7IC8vIFN1cHBvcnQgZm9yIGV4dGVybmFsIG1vZHVsZXMsIGxpa2UgcmVhY3QtbmF0aXZlLXdpbmRvd3NcblxuaWYgKCFSQ1RBc3luY1N0b3JhZ2UpIHtcbiAgdGhyb3cgbmV3IEVycm9yKGBbQFJOQy9Bc3luY1N0b3JhZ2VdOiBOYXRpdmVNb2R1bGU6IEFzeW5jU3RvcmFnZSBpcyBudWxsLlxuXG5UbyBmaXggdGhpcyBpc3N1ZSB0cnkgdGhlc2Ugc3RlcHM6XG5cbiAg4oCiIFJ1biBcXGByZWFjdC1uYXRpdmUgbGluayBAcmVhY3QtbmF0aXZlLWNvbW11bml0eS9hc3luYy1zdG9yYWdlXFxgIGluIHRoZSBwcm9qZWN0IHJvb3QuXG5cbiAg4oCiIFJlYnVpbGQgYW5kIHJlc3RhcnQgdGhlIGFwcC5cblxuICDigKIgUnVuIHRoZSBwYWNrYWdlciB3aXRoIFxcYC0tY2xlYXJDYWNoZVxcYCBmbGFnLlxuXG4gIOKAoiBJZiB5b3UgYXJlIHVzaW5nIENvY29hUG9kcyBvbiBpT1MsIHJ1biBcXGBwb2QgaW5zdGFsbFxcYCBpbiB0aGUgXFxgaW9zXFxgIGRpcmVjdG9yeSBhbmQgdGhlbiByZWJ1aWxkIGFuZCByZS1ydW4gdGhlIGFwcC5cblxuICDigKIgSWYgdGhpcyBoYXBwZW5zIHdoaWxlIHRlc3Rpbmcgd2l0aCBKZXN0LCBjaGVjayBvdXQgZG9jcyBob3cgdG8gaW50ZWdyYXRlIEFzeW5jU3RvcmFnZSB3aXRoIGl0OiBodHRwczovL2dpdGh1Yi5jb20vcmVhY3QtbmF0aXZlLWNvbW11bml0eS9hc3luYy1zdG9yYWdlL2Jsb2IvTEVHQUNZL2RvY3MvSmVzdC1pbnRlZ3JhdGlvbi5tZFxuXG5JZiBub25lIG9mIHRoZXNlIGZpeCB0aGUgaXNzdWUsIHBsZWFzZSBvcGVuIGFuIGlzc3VlIG9uIHRoZSBHaXRodWIgcmVwb3NpdG9yeTogaHR0cHM6Ly9naXRodWIuY29tL3JlYWN0LW5hdGl2ZS1jb21tdW5pdHkvcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvaXNzdWVzIFxuYCk7XG59XG5cbnR5cGUgUmVhZE9ubHlBcnJheVN0cmluZyA9ICRSZWFkT25seUFycmF5PHN0cmluZz47XG5cbnR5cGUgTXVsdGlHZXRDYWxsYmFja0Z1bmN0aW9uID0gKFxuICBlcnJvcnM6ID8kUmVhZE9ubHlBcnJheTxFcnJvcj4sXG4gIHJlc3VsdDogPyRSZWFkT25seUFycmF5PFJlYWRPbmx5QXJyYXlTdHJpbmc+LFxuKSA9PiB2b2lkO1xuXG50eXBlIE11bHRpUmVxdWVzdCA9IHt8XG4gIGtleXM6ICRSZWFkT25seUFycmF5PHN0cmluZz4sXG4gIGNhbGxiYWNrOiA/TXVsdGlHZXRDYWxsYmFja0Z1bmN0aW9uLFxuICBrZXlJbmRleDogbnVtYmVyLFxuICByZXNvbHZlOiA/KHJlc3VsdD86IFByb21pc2U8PyRSZWFkT25seUFycmF5PFJlYWRPbmx5QXJyYXlTdHJpbmc+PikgPT4gdm9pZCxcbiAgcmVqZWN0OiA/KGVycm9yPzogYW55KSA9PiB2b2lkLFxufH07XG5cbi8qKlxuICogYEFzeW5jU3RvcmFnZWAgaXMgYSBzaW1wbGUsIHVuZW5jcnlwdGVkLCBhc3luY2hyb25vdXMsIHBlcnNpc3RlbnQsIGtleS12YWx1ZVxuICogc3RvcmFnZSBzeXN0ZW0gdGhhdCBpcyBnbG9iYWwgdG8gdGhlIGFwcC4gIEl0IHNob3VsZCBiZSB1c2VkIGluc3RlYWQgb2ZcbiAqIExvY2FsU3RvcmFnZS5cbiAqXG4gKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbFxuICovXG5jb25zdCBBc3luY1N0b3JhZ2UgPSB7XG4gIF9nZXRSZXF1ZXN0czogKFtdOiBBcnJheTxNdWx0aVJlcXVlc3Q+KSxcbiAgX2dldEtleXM6IChbXTogQXJyYXk8c3RyaW5nPiksXG4gIF9pbW1lZGlhdGU6IChudWxsOiA/bnVtYmVyKSxcblxuICAvKipcbiAgICogRmV0Y2hlcyBhbiBpdGVtIGZvciBhIGBrZXlgIGFuZCBpbnZva2VzIGEgY2FsbGJhY2sgdXBvbiBjb21wbGV0aW9uLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbCNnZXRpdGVtXG4gICAqL1xuICBnZXRJdGVtOiBmdW5jdGlvbihcbiAgICBrZXk6IHN0cmluZyxcbiAgICBjYWxsYmFjaz86ID8oZXJyb3I6ID9FcnJvciwgcmVzdWx0OiBzdHJpbmcgfCBudWxsKSA9PiB2b2lkLFxuICApOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgUkNUQXN5bmNTdG9yYWdlLm11bHRpR2V0KFtrZXldLCBmdW5jdGlvbihlcnJvcnMsIHJlc3VsdCkge1xuICAgICAgICAvLyBVbnBhY2sgcmVzdWx0IHRvIGdldCB2YWx1ZSBmcm9tIFtba2V5LHZhbHVlXV1cbiAgICAgICAgY29uc3QgdmFsdWUgPSByZXN1bHQgJiYgcmVzdWx0WzBdICYmIHJlc3VsdFswXVsxXSA/IHJlc3VsdFswXVsxXSA6IG51bGw7XG4gICAgICAgIGNvbnN0IGVycnMgPSBjb252ZXJ0RXJyb3JzKGVycm9ycyk7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVycnMgJiYgZXJyc1swXSwgdmFsdWUpO1xuICAgICAgICBpZiAoZXJycykge1xuICAgICAgICAgIHJlamVjdChlcnJzWzBdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHZhbHVlIGZvciBhIGBrZXlgIGFuZCBpbnZva2VzIGEgY2FsbGJhY2sgdXBvbiBjb21wbGV0aW9uLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbCNzZXRpdGVtXG4gICAqL1xuICBzZXRJdGVtOiBmdW5jdGlvbihcbiAgICBrZXk6IHN0cmluZyxcbiAgICB2YWx1ZTogc3RyaW5nLFxuICAgIGNhbGxiYWNrPzogPyhlcnJvcjogP0Vycm9yKSA9PiB2b2lkLFxuICApOiBQcm9taXNlPG51bGw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgUkNUQXN5bmNTdG9yYWdlLm11bHRpU2V0KFtba2V5LCB2YWx1ZV1dLCBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgY29uc3QgZXJycyA9IGNvbnZlcnRFcnJvcnMoZXJyb3JzKTtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZXJycyAmJiBlcnJzWzBdKTtcbiAgICAgICAgaWYgKGVycnMpIHtcbiAgICAgICAgICByZWplY3QoZXJyc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYW4gaXRlbSBmb3IgYSBga2V5YCBhbmQgaW52b2tlcyBhIGNhbGxiYWNrIHVwb24gY29tcGxldGlvbi5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXN5bmNzdG9yYWdlLmh0bWwjcmVtb3ZlaXRlbVxuICAgKi9cbiAgcmVtb3ZlSXRlbTogZnVuY3Rpb24oXG4gICAga2V5OiBzdHJpbmcsXG4gICAgY2FsbGJhY2s/OiA/KGVycm9yOiA/RXJyb3IpID0+IHZvaWQsXG4gICk6IFByb21pc2U8bnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBSQ1RBc3luY1N0b3JhZ2UubXVsdGlSZW1vdmUoW2tleV0sIGZ1bmN0aW9uKGVycm9ycykge1xuICAgICAgICBjb25zdCBlcnJzID0gY29udmVydEVycm9ycyhlcnJvcnMpO1xuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlcnJzICYmIGVycnNbMF0pO1xuICAgICAgICBpZiAoZXJycykge1xuICAgICAgICAgIHJlamVjdChlcnJzWzBdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogTWVyZ2VzIGFuIGV4aXN0aW5nIGBrZXlgIHZhbHVlIHdpdGggYW4gaW5wdXQgdmFsdWUsIGFzc3VtaW5nIGJvdGggdmFsdWVzXG4gICAqIGFyZSBzdHJpbmdpZmllZCBKU09OLlxuICAgKlxuICAgKiAqKk5PVEU6KiogVGhpcyBpcyBub3Qgc3VwcG9ydGVkIGJ5IGFsbCBuYXRpdmUgaW1wbGVtZW50YXRpb25zLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbCNtZXJnZWl0ZW1cbiAgICovXG4gIG1lcmdlSXRlbTogZnVuY3Rpb24oXG4gICAga2V5OiBzdHJpbmcsXG4gICAgdmFsdWU6IHN0cmluZyxcbiAgICBjYWxsYmFjaz86ID8oZXJyb3I6ID9FcnJvcikgPT4gdm9pZCxcbiAgKTogUHJvbWlzZTxudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIFJDVEFzeW5jU3RvcmFnZS5tdWx0aU1lcmdlKFtba2V5LCB2YWx1ZV1dLCBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgY29uc3QgZXJycyA9IGNvbnZlcnRFcnJvcnMoZXJyb3JzKTtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZXJycyAmJiBlcnJzWzBdKTtcbiAgICAgICAgaWYgKGVycnMpIHtcbiAgICAgICAgICByZWplY3QoZXJyc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEVyYXNlcyAqYWxsKiBgQXN5bmNTdG9yYWdlYCBmb3IgYWxsIGNsaWVudHMsIGxpYnJhcmllcywgZXRjLiBZb3UgcHJvYmFibHlcbiAgICogZG9uJ3Qgd2FudCB0byBjYWxsIHRoaXM7IHVzZSBgcmVtb3ZlSXRlbWAgb3IgYG11bHRpUmVtb3ZlYCB0byBjbGVhciBvbmx5XG4gICAqIHlvdXIgYXBwJ3Mga2V5cy5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXN5bmNzdG9yYWdlLmh0bWwjY2xlYXJcbiAgICovXG4gIGNsZWFyOiBmdW5jdGlvbihjYWxsYmFjaz86ID8oZXJyb3I6ID9FcnJvcikgPT4gdm9pZCk6IFByb21pc2U8bnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBSQ1RBc3luY1N0b3JhZ2UuY2xlYXIoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyID0gY29udmVydEVycm9yKGVycm9yKTtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzICphbGwqIGtleXMga25vd24gdG8geW91ciBhcHA7IGZvciBhbGwgY2FsbGVycywgbGlicmFyaWVzLCBldGMuXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FzeW5jc3RvcmFnZS5odG1sI2dldGFsbGtleXNcbiAgICovXG4gIGdldEFsbEtleXM6IGZ1bmN0aW9uKFxuICAgIGNhbGxiYWNrPzogPyhlcnJvcjogP0Vycm9yLCBrZXlzOiA/UmVhZE9ubHlBcnJheVN0cmluZykgPT4gdm9pZCxcbiAgKTogUHJvbWlzZTxSZWFkT25seUFycmF5U3RyaW5nPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIFJDVEFzeW5jU3RvcmFnZS5nZXRBbGxLZXlzKGZ1bmN0aW9uKGVycm9yLCBrZXlzKSB7XG4gICAgICAgIGNvbnN0IGVyciA9IGNvbnZlcnRFcnJvcihlcnJvcik7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVyciwga2V5cyk7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKGtleXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGZvbGxvd2luZyBiYXRjaGVkIGZ1bmN0aW9ucyBhcmUgdXNlZnVsIGZvciBleGVjdXRpbmcgYSBsb3Qgb2ZcbiAgICogb3BlcmF0aW9ucyBhdCBvbmNlLCBhbGxvd2luZyBmb3IgbmF0aXZlIG9wdGltaXphdGlvbnMgYW5kIHByb3ZpZGUgdGhlXG4gICAqIGNvbnZlbmllbmNlIG9mIGEgc2luZ2xlIGNhbGxiYWNrIGFmdGVyIGFsbCBvcGVyYXRpb25zIGFyZSBjb21wbGV0ZS5cbiAgICpcbiAgICogVGhlc2UgZnVuY3Rpb25zIHJldHVybiBhcnJheXMgb2YgZXJyb3JzLCBwb3RlbnRpYWxseSBvbmUgZm9yIGV2ZXJ5IGtleS5cbiAgICogRm9yIGtleS1zcGVjaWZpYyBlcnJvcnMsIHRoZSBFcnJvciBvYmplY3Qgd2lsbCBoYXZlIGEga2V5IHByb3BlcnR5IHRvXG4gICAqIGluZGljYXRlIHdoaWNoIGtleSBjYXVzZWQgdGhlIGVycm9yLlxuICAgKi9cblxuICAvKipcbiAgICogRmx1c2hlcyBhbnkgcGVuZGluZyByZXF1ZXN0cyB1c2luZyBhIHNpbmdsZSBiYXRjaCBjYWxsIHRvIGdldCB0aGUgZGF0YS5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXN5bmNzdG9yYWdlLmh0bWwjZmx1c2hnZXRyZXF1ZXN0c1xuICAgKiAqL1xuICBmbHVzaEdldFJlcXVlc3RzOiBmdW5jdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCBnZXRSZXF1ZXN0cyA9IHRoaXMuX2dldFJlcXVlc3RzO1xuICAgIGNvbnN0IGdldEtleXMgPSB0aGlzLl9nZXRLZXlzO1xuXG4gICAgdGhpcy5fZ2V0UmVxdWVzdHMgPSBbXTtcbiAgICB0aGlzLl9nZXRLZXlzID0gW107XG5cbiAgICBSQ1RBc3luY1N0b3JhZ2UubXVsdGlHZXQoZ2V0S2V5cywgZnVuY3Rpb24oZXJyb3JzLCByZXN1bHQpIHtcbiAgICAgIC8vIEV2ZW4gdGhvdWdoIHRoZSBydW50aW1lIGNvbXBsZXhpdHkgb2YgdGhpcyBpcyB0aGVvcmV0aWNhbGx5IHdvcnNlIHZzIGlmIHdlIHVzZWQgYSBtYXAsXG4gICAgICAvLyBpdCdzIG11Y2gsIG11Y2ggZmFzdGVyIGluIHByYWN0aWNlIGZvciB0aGUgZGF0YSBzZXRzIHdlIGRlYWwgd2l0aCAod2UgYXZvaWRcbiAgICAgIC8vIGFsbG9jYXRpbmcgcmVzdWx0IHBhaXIgYXJyYXlzKS4gVGhpcyB3YXMgaGVhdmlseSBiZW5jaG1hcmtlZC5cbiAgICAgIC8vXG4gICAgICAvLyBJcyB0aGVyZSBhIHdheSB0byBhdm9pZCB1c2luZyB0aGUgbWFwIGJ1dCBmaXggdGhlIGJ1ZyBpbiB0aGlzIGJyZWFraW5nIHRlc3Q/XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QtbmF0aXZlL2NvbW1pdC84ZGQ4YWQ3NjU3OWQ3ZmVlZjM0YzAxNGQzODdiZjAyMDY1NjkyMjY0XG4gICAgICBjb25zdCBtYXAgPSB7fTtcbiAgICAgIHJlc3VsdCAmJlxuICAgICAgICByZXN1bHQuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgbWFwW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgY29uc3QgcmVxTGVuZ3RoID0gZ2V0UmVxdWVzdHMubGVuZ3RoO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXFMZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0gZ2V0UmVxdWVzdHNbaV07XG4gICAgICAgIGNvbnN0IHJlcXVlc3RLZXlzID0gcmVxdWVzdC5rZXlzO1xuICAgICAgICBjb25zdCByZXF1ZXN0UmVzdWx0ID0gcmVxdWVzdEtleXMubWFwKGtleSA9PiBba2V5LCBtYXBba2V5XV0pO1xuICAgICAgICByZXF1ZXN0LmNhbGxiYWNrICYmIHJlcXVlc3QuY2FsbGJhY2sobnVsbCwgcmVxdWVzdFJlc3VsdCk7XG4gICAgICAgIHJlcXVlc3QucmVzb2x2ZSAmJiByZXF1ZXN0LnJlc29sdmUocmVxdWVzdFJlc3VsdCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoaXMgYWxsb3dzIHlvdSB0byBiYXRjaCB0aGUgZmV0Y2hpbmcgb2YgaXRlbXMgZ2l2ZW4gYW4gYXJyYXkgb2YgYGtleWBcbiAgICogaW5wdXRzLiBZb3VyIGNhbGxiYWNrIHdpbGwgYmUgaW52b2tlZCB3aXRoIGFuIGFycmF5IG9mIGNvcnJlc3BvbmRpbmdcbiAgICoga2V5LXZhbHVlIHBhaXJzIGZvdW5kLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbCNtdWx0aWdldFxuICAgKi9cbiAgbXVsdGlHZXQ6IGZ1bmN0aW9uKFxuICAgIGtleXM6IEFycmF5PHN0cmluZz4sXG4gICAgY2FsbGJhY2s/OiA/TXVsdGlHZXRDYWxsYmFja0Z1bmN0aW9uLFxuICApOiBQcm9taXNlPD8kUmVhZE9ubHlBcnJheTxSZWFkT25seUFycmF5U3RyaW5nPj4ge1xuICAgIGlmICghdGhpcy5faW1tZWRpYXRlKSB7XG4gICAgICB0aGlzLl9pbW1lZGlhdGUgPSBzZXRJbW1lZGlhdGUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9pbW1lZGlhdGUgPSBudWxsO1xuICAgICAgICB0aGlzLmZsdXNoR2V0UmVxdWVzdHMoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGdldFJlcXVlc3Q6IE11bHRpUmVxdWVzdCA9IHtcbiAgICAgIGtleXM6IGtleXMsXG4gICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICAvLyBkbyB3ZSBuZWVkIHRoaXM/XG4gICAgICBrZXlJbmRleDogdGhpcy5fZ2V0S2V5cy5sZW5ndGgsXG4gICAgICByZXNvbHZlOiBudWxsLFxuICAgICAgcmVqZWN0OiBudWxsLFxuICAgIH07XG5cbiAgICBjb25zdCBwcm9taXNlUmVzdWx0ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgZ2V0UmVxdWVzdC5yZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgIGdldFJlcXVlc3QucmVqZWN0ID0gcmVqZWN0O1xuICAgIH0pO1xuXG4gICAgdGhpcy5fZ2V0UmVxdWVzdHMucHVzaChnZXRSZXF1ZXN0KTtcbiAgICAvLyBhdm9pZCBmZXRjaGluZyBkdXBsaWNhdGVzXG4gICAga2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAodGhpcy5fZ2V0S2V5cy5pbmRleE9mKGtleSkgPT09IC0xKSB7XG4gICAgICAgIHRoaXMuX2dldEtleXMucHVzaChrZXkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHByb21pc2VSZXN1bHQ7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIGFzIGEgYmF0Y2ggb3BlcmF0aW9uIGZvciBzdG9yaW5nIG11bHRpcGxlIGtleS12YWx1ZSBwYWlycy4gV2hlblxuICAgKiB0aGUgb3BlcmF0aW9uIGNvbXBsZXRlcyB5b3UnbGwgZ2V0IGEgc2luZ2xlIGNhbGxiYWNrIHdpdGggYW55IGVycm9ycy5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXN5bmNzdG9yYWdlLmh0bWwjbXVsdGlzZXRcbiAgICovXG4gIG11bHRpU2V0OiBmdW5jdGlvbihcbiAgICBrZXlWYWx1ZVBhaXJzOiBBcnJheTxBcnJheTxzdHJpbmc+PixcbiAgICBjYWxsYmFjaz86ID8oZXJyb3JzOiA/JFJlYWRPbmx5QXJyYXk8P0Vycm9yPikgPT4gdm9pZCxcbiAgKTogUHJvbWlzZTxudWxsPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIFJDVEFzeW5jU3RvcmFnZS5tdWx0aVNldChrZXlWYWx1ZVBhaXJzLCBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBjb252ZXJ0RXJyb3JzKGVycm9ycyk7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogQ2FsbCB0aGlzIHRvIGJhdGNoIHRoZSBkZWxldGlvbiBvZiBhbGwga2V5cyBpbiB0aGUgYGtleXNgIGFycmF5LlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hc3luY3N0b3JhZ2UuaHRtbCNtdWx0aXJlbW92ZVxuICAgKi9cbiAgbXVsdGlSZW1vdmU6IGZ1bmN0aW9uKFxuICAgIGtleXM6IEFycmF5PHN0cmluZz4sXG4gICAgY2FsbGJhY2s/OiA/KGVycm9yczogPyRSZWFkT25seUFycmF5PD9FcnJvcj4pID0+IHZvaWQsXG4gICk6IFByb21pc2U8bnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBSQ1RBc3luY1N0b3JhZ2UubXVsdGlSZW1vdmUoa2V5cywgZnVuY3Rpb24oZXJyb3JzKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gY29udmVydEVycm9ycyhlcnJvcnMpO1xuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEJhdGNoIG9wZXJhdGlvbiB0byBtZXJnZSBpbiBleGlzdGluZyBhbmQgbmV3IHZhbHVlcyBmb3IgYSBnaXZlbiBzZXQgb2ZcbiAgICoga2V5cy4gVGhpcyBhc3N1bWVzIHRoYXQgdGhlIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgSlNPTi5cbiAgICpcbiAgICogKipOT1RFKio6IFRoaXMgaXMgbm90IHN1cHBvcnRlZCBieSBhbGwgbmF0aXZlIGltcGxlbWVudGF0aW9ucy5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXN5bmNzdG9yYWdlLmh0bWwjbXVsdGltZXJnZVxuICAgKi9cbiAgbXVsdGlNZXJnZTogZnVuY3Rpb24oXG4gICAga2V5VmFsdWVQYWlyczogQXJyYXk8QXJyYXk8c3RyaW5nPj4sXG4gICAgY2FsbGJhY2s/OiA/KGVycm9yczogPyRSZWFkT25seUFycmF5PD9FcnJvcj4pID0+IHZvaWQsXG4gICk6IFByb21pc2U8bnVsbD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBSQ1RBc3luY1N0b3JhZ2UubXVsdGlNZXJnZShrZXlWYWx1ZVBhaXJzLCBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBjb252ZXJ0RXJyb3JzKGVycm9ycyk7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbn07XG5cbi8vIE5vdCBhbGwgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBzdXBwb3J0IG1lcmdlLlxuaWYgKCFSQ1RBc3luY1N0b3JhZ2UubXVsdGlNZXJnZSkge1xuICBkZWxldGUgQXN5bmNTdG9yYWdlLm1lcmdlSXRlbTtcbiAgZGVsZXRlIEFzeW5jU3RvcmFnZS5tdWx0aU1lcmdlO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0RXJyb3JzKGVycnMpOiA/JFJlYWRPbmx5QXJyYXk8P0Vycm9yPiB7XG4gIGlmICghZXJycykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHJldHVybiAoQXJyYXkuaXNBcnJheShlcnJzKSA/IGVycnMgOiBbZXJyc10pLm1hcChlID0+IGNvbnZlcnRFcnJvcihlKSk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRFcnJvcihlcnJvcik6ID9FcnJvciB7XG4gIGlmICghZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBvdXQgPSBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gIC8vICRGbG93Rml4TWU6IGFkZGluZyBjdXN0b20gcHJvcGVydGllcyB0byBlcnJvci5cbiAgb3V0LmtleSA9IGVycm9yLmtleTtcbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQXN5bmNTdG9yYWdlO1xuIl19