5aa5df74a7cd0f8a2d8b66fd8c825bea
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

Object.defineProperty(exports, "__esModule", {
  value: true
});

var LayoutType_1 = require("./LayoutType");

var LayoutTreeParser = function () {
  function LayoutTreeParser(uniqueIdProvider) {
    (0, _classCallCheck2.default)(this, LayoutTreeParser);
    this.uniqueIdProvider = uniqueIdProvider;
    this.parse = this.parse.bind(this);
  }

  (0, _createClass2.default)(LayoutTreeParser, [{
    key: "parse",
    value: function parse(api) {
      if (api.topTabs) {
        return this.topTabs(api.topTabs);
      } else if (api.sideMenu) {
        return this.sideMenu(api.sideMenu);
      } else if (api.bottomTabs) {
        return this.bottomTabs(api.bottomTabs);
      } else if (api.stack) {
        return this.stack(api.stack);
      } else if (api.component) {
        return this.component(api.component);
      } else if (api.externalComponent) {
        return this.externalComponent(api.externalComponent);
      } else if (api.splitView) {
        return this.splitView(api.splitView);
      }

      throw new Error("unknown LayoutType \"" + Object.keys(api) + "\"");
    }
  }, {
    key: "topTabs",
    value: function topTabs(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.TopTabs),
        type: LayoutType_1.LayoutType.TopTabs,
        data: {
          options: api.options
        },
        children: api.children ? api.children.map(this.parse) : []
      };
    }
  }, {
    key: "sideMenu",
    value: function sideMenu(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.SideMenuRoot),
        type: LayoutType_1.LayoutType.SideMenuRoot,
        data: {
          options: api.options
        },
        children: this.sideMenuChildren(api)
      };
    }
  }, {
    key: "sideMenuChildren",
    value: function sideMenuChildren(api) {
      var children = [];

      if (api.left) {
        children.push({
          id: this.uniqueIdProvider.generate(LayoutType_1.LayoutType.SideMenuLeft),
          type: LayoutType_1.LayoutType.SideMenuLeft,
          data: {},
          children: [this.parse(api.left)]
        });
      }

      children.push({
        id: this.uniqueIdProvider.generate(LayoutType_1.LayoutType.SideMenuCenter),
        type: LayoutType_1.LayoutType.SideMenuCenter,
        data: {},
        children: [this.parse(api.center)]
      });

      if (api.right) {
        children.push({
          id: this.uniqueIdProvider.generate(LayoutType_1.LayoutType.SideMenuRight),
          type: LayoutType_1.LayoutType.SideMenuRight,
          data: {},
          children: [this.parse(api.right)]
        });
      }

      return children;
    }
  }, {
    key: "bottomTabs",
    value: function bottomTabs(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.BottomTabs),
        type: LayoutType_1.LayoutType.BottomTabs,
        data: {
          options: api.options
        },
        children: api.children ? api.children.map(this.parse) : []
      };
    }
  }, {
    key: "stack",
    value: function stack(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.Stack),
        type: LayoutType_1.LayoutType.Stack,
        data: {
          options: api.options
        },
        children: api.children ? api.children.map(this.parse) : []
      };
    }
  }, {
    key: "component",
    value: function component(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.Component),
        type: LayoutType_1.LayoutType.Component,
        data: {
          name: api.name.toString(),
          options: api.options,
          passProps: api.passProps
        },
        children: []
      };
    }
  }, {
    key: "externalComponent",
    value: function externalComponent(api) {
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.ExternalComponent),
        type: LayoutType_1.LayoutType.ExternalComponent,
        data: {
          name: api.name.toString(),
          options: api.options,
          passProps: api.passProps
        },
        children: []
      };
    }
  }, {
    key: "splitView",
    value: function splitView(api) {
      var master = api.master ? this.parse(api.master) : undefined;
      var detail = api.detail ? this.parse(api.detail) : undefined;
      return {
        id: api.id || this.uniqueIdProvider.generate(LayoutType_1.LayoutType.SplitView),
        type: LayoutType_1.LayoutType.SplitView,
        data: {
          options: api.options
        },
        children: master && detail ? [master, detail] : []
      };
    }
  }]);
  return LayoutTreeParser;
}();

exports.LayoutTreeParser = LayoutTreeParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxheW91dFRyZWVQYXJzZXIuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJMYXlvdXRUeXBlXzEiLCJyZXF1aXJlIiwiTGF5b3V0VHJlZVBhcnNlciIsInVuaXF1ZUlkUHJvdmlkZXIiLCJwYXJzZSIsImJpbmQiLCJhcGkiLCJ0b3BUYWJzIiwic2lkZU1lbnUiLCJib3R0b21UYWJzIiwic3RhY2siLCJjb21wb25lbnQiLCJleHRlcm5hbENvbXBvbmVudCIsInNwbGl0VmlldyIsIkVycm9yIiwia2V5cyIsImlkIiwiZ2VuZXJhdGUiLCJMYXlvdXRUeXBlIiwiVG9wVGFicyIsInR5cGUiLCJkYXRhIiwib3B0aW9ucyIsImNoaWxkcmVuIiwibWFwIiwiU2lkZU1lbnVSb290Iiwic2lkZU1lbnVDaGlsZHJlbiIsImxlZnQiLCJwdXNoIiwiU2lkZU1lbnVMZWZ0IiwiU2lkZU1lbnVDZW50ZXIiLCJjZW50ZXIiLCJyaWdodCIsIlNpZGVNZW51UmlnaHQiLCJCb3R0b21UYWJzIiwiU3RhY2siLCJDb21wb25lbnQiLCJuYW1lIiwidG9TdHJpbmciLCJwYXNzUHJvcHMiLCJFeHRlcm5hbENvbXBvbmVudCIsIm1hc3RlciIsInVuZGVmaW5lZCIsImRldGFpbCIsIlNwbGl0VmlldyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7O0FBQ0EsSUFBTUMsWUFBWSxHQUFHQyxPQUFPLGdCQUE1Qjs7SUFDTUMsZ0I7QUFDRiw0QkFBWUMsZ0JBQVosRUFBOEI7QUFBQTtBQUMxQixTQUFLQSxnQkFBTCxHQUF3QkEsZ0JBQXhCO0FBQ0EsU0FBS0MsS0FBTCxHQUFhLEtBQUtBLEtBQUwsQ0FBV0MsSUFBWCxDQUFnQixJQUFoQixDQUFiO0FBQ0g7Ozs7MEJBQ0tDLEcsRUFB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LElBQUlFLE1BQVYsR0FBbUIsQ0FBQ0YsTUFBRCxFQUFTRSxNQUFULENBQW5CLEdBQXNDO0FBSjdDLE9BQVA7QUFNSDs7Ozs7QUFFTDdDLE9BQU8sQ0FBQ0ksZ0JBQVIsR0FBMkJBLGdCQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgTGF5b3V0VHlwZV8xID0gcmVxdWlyZShcIi4vTGF5b3V0VHlwZVwiKTtcbmNsYXNzIExheW91dFRyZWVQYXJzZXIge1xuICAgIGNvbnN0cnVjdG9yKHVuaXF1ZUlkUHJvdmlkZXIpIHtcbiAgICAgICAgdGhpcy51bmlxdWVJZFByb3ZpZGVyID0gdW5pcXVlSWRQcm92aWRlcjtcbiAgICAgICAgdGhpcy5wYXJzZSA9IHRoaXMucGFyc2UuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgcGFyc2UoYXBpKSB7XG4gICAgICAgIGlmIChhcGkudG9wVGFicykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9wVGFicyhhcGkudG9wVGFicyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYXBpLnNpZGVNZW51KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zaWRlTWVudShhcGkuc2lkZU1lbnUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFwaS5ib3R0b21UYWJzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib3R0b21UYWJzKGFwaS5ib3R0b21UYWJzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhcGkuc3RhY2spIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YWNrKGFwaS5zdGFjayk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYXBpLmNvbXBvbmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50KGFwaS5jb21wb25lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFwaS5leHRlcm5hbENvbXBvbmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXh0ZXJuYWxDb21wb25lbnQoYXBpLmV4dGVybmFsQ29tcG9uZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhcGkuc3BsaXRWaWV3KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zcGxpdFZpZXcoYXBpLnNwbGl0Vmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIExheW91dFR5cGUgXCIke09iamVjdC5rZXlzKGFwaSl9XCJgKTtcbiAgICB9XG4gICAgdG9wVGFicyhhcGkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBhcGkuaWQgfHwgdGhpcy51bmlxdWVJZFByb3ZpZGVyLmdlbmVyYXRlKExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlRvcFRhYnMpLFxuICAgICAgICAgICAgdHlwZTogTGF5b3V0VHlwZV8xLkxheW91dFR5cGUuVG9wVGFicyxcbiAgICAgICAgICAgIGRhdGE6IHsgb3B0aW9uczogYXBpLm9wdGlvbnMgfSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBhcGkuY2hpbGRyZW4gPyBhcGkuY2hpbGRyZW4ubWFwKHRoaXMucGFyc2UpIDogW11cbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2lkZU1lbnUoYXBpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogYXBpLmlkIHx8IHRoaXMudW5pcXVlSWRQcm92aWRlci5nZW5lcmF0ZShMYXlvdXRUeXBlXzEuTGF5b3V0VHlwZS5TaWRlTWVudVJvb3QpLFxuICAgICAgICAgICAgdHlwZTogTGF5b3V0VHlwZV8xLkxheW91dFR5cGUuU2lkZU1lbnVSb290LFxuICAgICAgICAgICAgZGF0YTogeyBvcHRpb25zOiBhcGkub3B0aW9ucyB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IHRoaXMuc2lkZU1lbnVDaGlsZHJlbihhcGkpXG4gICAgICAgIH07XG4gICAgfVxuICAgIHNpZGVNZW51Q2hpbGRyZW4oYXBpKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XG4gICAgICAgIGlmIChhcGkubGVmdCkge1xuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMudW5pcXVlSWRQcm92aWRlci5nZW5lcmF0ZShMYXlvdXRUeXBlXzEuTGF5b3V0VHlwZS5TaWRlTWVudUxlZnQpLFxuICAgICAgICAgICAgICAgIHR5cGU6IExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlNpZGVNZW51TGVmdCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7fSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3RoaXMucGFyc2UoYXBpLmxlZnQpXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2hpbGRyZW4ucHVzaCh7XG4gICAgICAgICAgICBpZDogdGhpcy51bmlxdWVJZFByb3ZpZGVyLmdlbmVyYXRlKExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlNpZGVNZW51Q2VudGVyKSxcbiAgICAgICAgICAgIHR5cGU6IExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlNpZGVNZW51Q2VudGVyLFxuICAgICAgICAgICAgZGF0YToge30sXG4gICAgICAgICAgICBjaGlsZHJlbjogW3RoaXMucGFyc2UoYXBpLmNlbnRlcildXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoYXBpLnJpZ2h0KSB7XG4gICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogdGhpcy51bmlxdWVJZFByb3ZpZGVyLmdlbmVyYXRlKExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlNpZGVNZW51UmlnaHQpLFxuICAgICAgICAgICAgICAgIHR5cGU6IExheW91dFR5cGVfMS5MYXlvdXRUeXBlLlNpZGVNZW51UmlnaHQsXG4gICAgICAgICAgICAgICAgZGF0YToge30sXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFt0aGlzLnBhcnNlKGFwaS5yaWdodCldXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hpbGRyZW47XG4gICAgfVxuICAgIGJvdHRvbVRhYnMoYXBpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogYXBpLmlkIHx8IHRoaXMudW5pcXVlSWRQcm92aWRlci5nZW5lcmF0ZShMYXlvdXRUeXBlXzEuTGF5b3V0VHlwZS5Cb3R0b21UYWJzKSxcbiAgICAgICAgICAgIHR5cGU6IExheW91dFR5cGVfMS5MYXlvdXRUeXBlLkJvdHRvbVRhYnMsXG4gICAgICAgICAgICBkYXRhOiB7IG9wdGlvbnM6IGFwaS5vcHRpb25zIH0sXG4gICAgICAgICAgICBjaGlsZHJlbjogYXBpLmNoaWxkcmVuID8gYXBpLmNoaWxkcmVuLm1hcCh0aGlzLnBhcnNlKSA6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YWNrKGFwaSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGFwaS5pZCB8fCB0aGlzLnVuaXF1ZUlkUHJvdmlkZXIuZ2VuZXJhdGUoTGF5b3V0VHlwZV8xLkxheW91dFR5cGUuU3RhY2spLFxuICAgICAgICAgICAgdHlwZTogTGF5b3V0VHlwZV8xLkxheW91dFR5cGUuU3RhY2ssXG4gICAgICAgICAgICBkYXRhOiB7IG9wdGlvbnM6IGFwaS5vcHRpb25zIH0sXG4gICAgICAgICAgICBjaGlsZHJlbjogYXBpLmNoaWxkcmVuID8gYXBpLmNoaWxkcmVuLm1hcCh0aGlzLnBhcnNlKSA6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudChhcGkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBhcGkuaWQgfHwgdGhpcy51bmlxdWVJZFByb3ZpZGVyLmdlbmVyYXRlKExheW91dFR5cGVfMS5MYXlvdXRUeXBlLkNvbXBvbmVudCksXG4gICAgICAgICAgICB0eXBlOiBMYXlvdXRUeXBlXzEuTGF5b3V0VHlwZS5Db21wb25lbnQsXG4gICAgICAgICAgICBkYXRhOiB7IG5hbWU6IGFwaS5uYW1lLnRvU3RyaW5nKCksIG9wdGlvbnM6IGFwaS5vcHRpb25zLCBwYXNzUHJvcHM6IGFwaS5wYXNzUHJvcHMgfSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBbXVxuICAgICAgICB9O1xuICAgIH1cbiAgICBleHRlcm5hbENvbXBvbmVudChhcGkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBhcGkuaWQgfHwgdGhpcy51bmlxdWVJZFByb3ZpZGVyLmdlbmVyYXRlKExheW91dFR5cGVfMS5MYXlvdXRUeXBlLkV4dGVybmFsQ29tcG9uZW50KSxcbiAgICAgICAgICAgIHR5cGU6IExheW91dFR5cGVfMS5MYXlvdXRUeXBlLkV4dGVybmFsQ29tcG9uZW50LFxuICAgICAgICAgICAgZGF0YTogeyBuYW1lOiBhcGkubmFtZS50b1N0cmluZygpLCBvcHRpb25zOiBhcGkub3B0aW9ucywgcGFzc1Byb3BzOiBhcGkucGFzc1Byb3BzIH0sXG4gICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3BsaXRWaWV3KGFwaSkge1xuICAgICAgICBjb25zdCBtYXN0ZXIgPSBhcGkubWFzdGVyID8gdGhpcy5wYXJzZShhcGkubWFzdGVyKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgZGV0YWlsID0gYXBpLmRldGFpbCA/IHRoaXMucGFyc2UoYXBpLmRldGFpbCkgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogYXBpLmlkIHx8IHRoaXMudW5pcXVlSWRQcm92aWRlci5nZW5lcmF0ZShMYXlvdXRUeXBlXzEuTGF5b3V0VHlwZS5TcGxpdFZpZXcpLFxuICAgICAgICAgICAgdHlwZTogTGF5b3V0VHlwZV8xLkxheW91dFR5cGUuU3BsaXRWaWV3LFxuICAgICAgICAgICAgZGF0YTogeyBvcHRpb25zOiBhcGkub3B0aW9ucyB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IG1hc3RlciAmJiBkZXRhaWwgPyBbbWFzdGVyLCBkZXRhaWxdIDogW11cbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnRzLkxheW91dFRyZWVQYXJzZXIgPSBMYXlvdXRUcmVlUGFyc2VyO1xuIl19