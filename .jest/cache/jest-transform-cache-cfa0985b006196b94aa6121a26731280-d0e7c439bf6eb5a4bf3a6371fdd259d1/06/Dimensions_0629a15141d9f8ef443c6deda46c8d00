c28b80db754d9dcbda56d1d1bc8e9a3b
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EventEmitter = require('EventEmitter');

var Platform = require('Platform');

var RCTDeviceEventEmitter = require('RCTDeviceEventEmitter');

var invariant = require('invariant');

var eventEmitter = new EventEmitter();
var dimensionsInitialized = false;
var dimensions = {};

var Dimensions = function () {
  function Dimensions() {
    (0, _classCallCheck2.default)(this, Dimensions);
  }

  (0, _createClass2.default)(Dimensions, null, [{
    key: "set",
    value: function set(dims) {
      if (dims && dims.windowPhysicalPixels) {
        dims = JSON.parse(JSON.stringify(dims));
        var windowPhysicalPixels = dims.windowPhysicalPixels;
        dims.window = {
          width: windowPhysicalPixels.width / windowPhysicalPixels.scale,
          height: windowPhysicalPixels.height / windowPhysicalPixels.scale,
          scale: windowPhysicalPixels.scale,
          fontScale: windowPhysicalPixels.fontScale
        };

        if (Platform.OS === 'android') {
          var screenPhysicalPixels = dims.screenPhysicalPixels;
          dims.screen = {
            width: screenPhysicalPixels.width / screenPhysicalPixels.scale,
            height: screenPhysicalPixels.height / screenPhysicalPixels.scale,
            scale: screenPhysicalPixels.scale,
            fontScale: screenPhysicalPixels.fontScale
          };
          delete dims.screenPhysicalPixels;
        } else {
          dims.screen = dims.window;
        }

        delete dims.windowPhysicalPixels;
      }

      (0, _extends2.default)(dimensions, dims);

      if (dimensionsInitialized) {
        eventEmitter.emit('change', {
          window: dimensions.window,
          screen: dimensions.screen
        });
      } else {
        dimensionsInitialized = true;
      }
    }
  }, {
    key: "get",
    value: function get(dim) {
      invariant(dimensions[dim], 'No dimension set for key ' + dim);
      return dimensions[dim];
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(type, handler) {
      invariant(type === 'change', 'Trying to subscribe to unknown event: "%s"', type);
      eventEmitter.addListener(type, handler);
    }
  }, {
    key: "removeEventListener",
    value: function removeEventListener(type, handler) {
      invariant(type === 'change', 'Trying to remove listener for unknown event: "%s"', type);
      eventEmitter.removeListener(type, handler);
    }
  }]);
  return Dimensions;
}();

var dims = global.nativeExtensions && global.nativeExtensions.DeviceInfo && global.nativeExtensions.DeviceInfo.Dimensions;
var nativeExtensionsEnabled = true;

if (!dims) {
  var DeviceInfo = require('DeviceInfo');

  dims = DeviceInfo.Dimensions;
  nativeExtensionsEnabled = false;
}

invariant(dims, 'Either DeviceInfo native extension or DeviceInfo Native Module must be registered');
Dimensions.set(dims);

if (!nativeExtensionsEnabled) {
  RCTDeviceEventEmitter.addListener('didUpdateDimensions', function (update) {
    Dimensions.set(update);
  });
}

module.exports = Dimensions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRpbWVuc2lvbnMuanMiXSwibmFtZXMiOlsiRXZlbnRFbWl0dGVyIiwicmVxdWlyZSIsIlBsYXRmb3JtIiwiUkNURGV2aWNlRXZlbnRFbWl0dGVyIiwiaW52YXJpYW50IiwiZXZlbnRFbWl0dGVyIiwiZGltZW5zaW9uc0luaXRpYWxpemVkIiwiZGltZW5zaW9ucyIsIkRpbWVuc2lvbnMiLCJkaW1zIiwid2luZG93UGh5c2ljYWxQaXhlbHMiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ3aW5kb3ciLCJ3aWR0aCIsInNjYWxlIiwiaGVpZ2h0IiwiZm9udFNjYWxlIiwiT1MiLCJzY3JlZW5QaHlzaWNhbFBpeGVscyIsInNjcmVlbiIsImVtaXQiLCJkaW0iLCJ0eXBlIiwiaGFuZGxlciIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJnbG9iYWwiLCJuYXRpdmVFeHRlbnNpb25zIiwiRGV2aWNlSW5mbyIsIm5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkIiwic2V0IiwidXBkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxjQUFELENBQTVCOztBQUNBLElBQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBeEI7O0FBQ0EsSUFBTUUscUJBQXFCLEdBQUdGLE9BQU8sQ0FBQyx1QkFBRCxDQUFyQzs7QUFFQSxJQUFNRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUVBLElBQU1JLFlBQVksR0FBRyxJQUFJTCxZQUFKLEVBQXJCO0FBQ0EsSUFBSU0scUJBQXFCLEdBQUcsS0FBNUI7QUFDQSxJQUFNQyxVQUFVLEdBQUcsRUFBbkI7O0lBQ01DLFU7Ozs7Ozs7d0JBT09DLEksRUFBa0M7QUFJM0MsVUFBSUEsSUFBSSxJQUFJQSxJQUFJLENBQUNDLG9CQUFqQixFQUF1QztBQUVyQ0QsUUFBQUEsSUFBSSxHQUFHRSxJQUFJLENBQUND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dUIsRUFBQUEsdUJBQXVCLEdBQUcsS0FBMUI7QUFDRDs7QUFFRDNCLFNBQVMsQ0FDUEssSUFETyxFQUVQLG1GQUZPLENBQVQ7QUFJQUQsVUFBVSxDQUFDd0IsR0FBWCxDQUFldkIsSUFBZjs7QUFDQSxJQUFJLENBQUNzQix1QkFBTCxFQUE4QjtBQUM1QjVCLEVBQUFBLHFCQUFxQixDQUFDdUIsV0FBdEIsQ0FBa0MscUJBQWxDLEVBQXlELFVBQVNPLE1BQVQsRUFBaUI7QUFDeEV6QixJQUFBQSxVQUFVLENBQUN3QixHQUFYLENBQWVDLE1BQWY7QUFDRCxHQUZEO0FBR0Q7O0FBRURDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNCLFVBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnRXZlbnRFbWl0dGVyJyk7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJ1BsYXRmb3JtJyk7XG5jb25zdCBSQ1REZXZpY2VFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdSQ1REZXZpY2VFdmVudEVtaXR0ZXInKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbmNvbnN0IGV2ZW50RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbmxldCBkaW1lbnNpb25zSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbmNvbnN0IGRpbWVuc2lvbnMgPSB7fTtcbmNsYXNzIERpbWVuc2lvbnMge1xuICAvKipcbiAgICogVGhpcyBzaG91bGQgb25seSBiZSBjYWxsZWQgZnJvbSBuYXRpdmUgY29kZSBieSBzZW5kaW5nIHRoZVxuICAgKiBkaWRVcGRhdGVEaW1lbnNpb25zIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gZGltcyBTaW1wbGUgc3RyaW5nLWtleWVkIG9iamVjdCBvZiBkaW1lbnNpb25zIHRvIHNldFxuICAgKi9cbiAgc3RhdGljIHNldChkaW1zOiB7W2tleTogc3RyaW5nXTogYW55fSk6IHZvaWQge1xuICAgIC8vIFdlIGNhbGN1bGF0ZSB0aGUgd2luZG93IGRpbWVuc2lvbnMgaW4gSlMgc28gdGhhdCB3ZSBkb24ndCBlbmNvdW50ZXIgbG9zcyBvZlxuICAgIC8vIHByZWNpc2lvbiBpbiB0cmFuc2ZlcnJpbmcgdGhlIGRpbWVuc2lvbnMgKHdoaWNoIGNvdWxkIGJlIG5vbi1pbnRlZ2Vycykgb3ZlclxuICAgIC8vIHRoZSBicmlkZ2UuXG4gICAgaWYgKGRpbXMgJiYgZGltcy53aW5kb3dQaHlzaWNhbFBpeGVscykge1xuICAgICAgLy8gcGFyc2Uvc3RyaW5naWZ5ID0+IENsb25lIGhhY2tcbiAgICAgIGRpbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRpbXMpKTtcblxuICAgICAgY29uc3Qgd2luZG93UGh5c2ljYWxQaXhlbHMgPSBkaW1zLndpbmRvd1BoeXNpY2FsUGl4ZWxzO1xuICAgICAgZGltcy53aW5kb3cgPSB7XG4gICAgICAgIHdpZHRoOiB3aW5kb3dQaHlzaWNhbFBpeGVscy53aWR0aCAvIHdpbmRvd1BoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICBoZWlnaHQ6IHdpbmRvd1BoeXNpY2FsUGl4ZWxzLmhlaWdodCAvIHdpbmRvd1BoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICBzY2FsZTogd2luZG93UGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgIGZvbnRTY2FsZTogd2luZG93UGh5c2ljYWxQaXhlbHMuZm9udFNjYWxlLFxuICAgICAgfTtcbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgIC8vIFNjcmVlbiBhbmQgd2luZG93IGRpbWVuc2lvbnMgYXJlIGRpZmZlcmVudCBvbiBhbmRyb2lkXG4gICAgICAgIGNvbnN0IHNjcmVlblBoeXNpY2FsUGl4ZWxzID0gZGltcy5zY3JlZW5QaHlzaWNhbFBpeGVscztcbiAgICAgICAgZGltcy5zY3JlZW4gPSB7XG4gICAgICAgICAgd2lkdGg6IHNjcmVlblBoeXNpY2FsUGl4ZWxzLndpZHRoIC8gc2NyZWVuUGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgICAgaGVpZ2h0OiBzY3JlZW5QaHlzaWNhbFBpeGVscy5oZWlnaHQgLyBzY3JlZW5QaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgICBzY2FsZTogc2NyZWVuUGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgICAgZm9udFNjYWxlOiBzY3JlZW5QaHlzaWNhbFBpeGVscy5mb250U2NhbGUsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gZGVsZXRlIHNvIG5vIGNhbGxlcnMgcmVseSBvbiB0aGlzIGV4aXN0aW5nXG4gICAgICAgIGRlbGV0ZSBkaW1zLnNjcmVlblBoeXNpY2FsUGl4ZWxzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGltcy5zY3JlZW4gPSBkaW1zLndpbmRvdztcbiAgICAgIH1cbiAgICAgIC8vIGRlbGV0ZSBzbyBubyBjYWxsZXJzIHJlbHkgb24gdGhpcyBleGlzdGluZ1xuICAgICAgZGVsZXRlIGRpbXMud2luZG93UGh5c2ljYWxQaXhlbHM7XG4gICAgfVxuXG4gICAgT2JqZWN0LmFzc2lnbihkaW1lbnNpb25zLCBkaW1zKTtcbiAgICBpZiAoZGltZW5zaW9uc0luaXRpYWxpemVkKSB7XG4gICAgICAvLyBEb24ndCBmaXJlICdjaGFuZ2UnIHRoZSBmaXJzdCB0aW1lIHRoZSBkaW1lbnNpb25zIGFyZSBzZXQuXG4gICAgICBldmVudEVtaXR0ZXIuZW1pdCgnY2hhbmdlJywge1xuICAgICAgICB3aW5kb3c6IGRpbWVuc2lvbnMud2luZG93LFxuICAgICAgICBzY3JlZW46IGRpbWVuc2lvbnMuc2NyZWVuLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpbWVuc2lvbnNJbml0aWFsaXplZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWwgZGltZW5zaW9ucyBhcmUgc2V0IGJlZm9yZSBgcnVuQXBwbGljYXRpb25gIGlzIGNhbGxlZCBzbyB0aGV5IHNob3VsZFxuICAgKiBiZSBhdmFpbGFibGUgYmVmb3JlIGFueSBvdGhlciByZXF1aXJlJ3MgYXJlIHJ1biwgYnV0IG1heSBiZSB1cGRhdGVkIGxhdGVyLlxuICAgKlxuICAgKiBOb3RlOiBBbHRob3VnaCBkaW1lbnNpb25zIGFyZSBhdmFpbGFibGUgaW1tZWRpYXRlbHksIHRoZXkgbWF5IGNoYW5nZSAoZS5nXG4gICAqIGR1ZSB0byBkZXZpY2Ugcm90YXRpb24pIHNvIGFueSByZW5kZXJpbmcgbG9naWMgb3Igc3R5bGVzIHRoYXQgZGVwZW5kIG9uXG4gICAqIHRoZXNlIGNvbnN0YW50cyBzaG91bGQgdHJ5IHRvIGNhbGwgdGhpcyBmdW5jdGlvbiBvbiBldmVyeSByZW5kZXIsIHJhdGhlclxuICAgKiB0aGFuIGNhY2hpbmcgdGhlIHZhbHVlIChmb3IgZXhhbXBsZSwgdXNpbmcgaW5saW5lIHN0eWxlcyByYXRoZXIgdGhhblxuICAgKiBzZXR0aW5nIGEgdmFsdWUgaW4gYSBgU3R5bGVTaGVldGApLlxuICAgKlxuICAgKiBFeGFtcGxlOiBgdmFyIHtoZWlnaHQsIHdpZHRofSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKTtgXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkaW0gTmFtZSBvZiBkaW1lbnNpb24gYXMgZGVmaW5lZCB3aGVuIGNhbGxpbmcgYHNldGAuXG4gICAqIEByZXR1cm5zIHtPYmplY3Q/fSBWYWx1ZSBmb3IgdGhlIGRpbWVuc2lvbi5cbiAgICovXG4gIHN0YXRpYyBnZXQoZGltOiBzdHJpbmcpOiBPYmplY3Qge1xuICAgIGludmFyaWFudChkaW1lbnNpb25zW2RpbV0sICdObyBkaW1lbnNpb24gc2V0IGZvciBrZXkgJyArIGRpbSk7XG4gICAgcmV0dXJuIGRpbWVuc2lvbnNbZGltXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gZXZlbnQgaGFuZGxlci4gU3VwcG9ydGVkIGV2ZW50czpcbiAgICpcbiAgICogLSBgY2hhbmdlYDogRmlyZXMgd2hlbiBhIHByb3BlcnR5IHdpdGhpbiB0aGUgYERpbWVuc2lvbnNgIG9iamVjdCBjaGFuZ2VzLiBUaGUgYXJndW1lbnRcbiAgICogICB0byB0aGUgZXZlbnQgaGFuZGxlciBpcyBhbiBvYmplY3Qgd2l0aCBgd2luZG93YCBhbmQgYHNjcmVlbmAgcHJvcGVydGllcyB3aG9zZSB2YWx1ZXNcbiAgICogICBhcmUgdGhlIHNhbWUgYXMgdGhlIHJldHVybiB2YWx1ZXMgb2YgYERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKWAgYW5kXG4gICAqICAgYERpbWVuc2lvbnMuZ2V0KCdzY3JlZW4nKWAsIHJlc3BlY3RpdmVseS5cbiAgICovXG4gIHN0YXRpYyBhZGRFdmVudExpc3RlbmVyKHR5cGU6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlID09PSAnY2hhbmdlJyxcbiAgICAgICdUcnlpbmcgdG8gc3Vic2NyaWJlIHRvIHVua25vd24gZXZlbnQ6IFwiJXNcIicsXG4gICAgICB0eXBlLFxuICAgICk7XG4gICAgZXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbiBldmVudCBoYW5kbGVyLlxuICAgKi9cbiAgc3RhdGljIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xuICAgIGludmFyaWFudChcbiAgICAgIHR5cGUgPT09ICdjaGFuZ2UnLFxuICAgICAgJ1RyeWluZyB0byByZW1vdmUgbGlzdGVuZXIgZm9yIHVua25vd24gZXZlbnQ6IFwiJXNcIicsXG4gICAgICB0eXBlLFxuICAgICk7XG4gICAgZXZlbnRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICB9XG59XG5cbmxldCBkaW1zOiA/e1trZXk6IHN0cmluZ106IGFueX0gPVxuICBnbG9iYWwubmF0aXZlRXh0ZW5zaW9ucyAmJlxuICBnbG9iYWwubmF0aXZlRXh0ZW5zaW9ucy5EZXZpY2VJbmZvICYmXG4gIGdsb2JhbC5uYXRpdmVFeHRlbnNpb25zLkRldmljZUluZm8uRGltZW5zaW9ucztcbmxldCBuYXRpdmVFeHRlbnNpb25zRW5hYmxlZCA9IHRydWU7XG5pZiAoIWRpbXMpIHtcbiAgY29uc3QgRGV2aWNlSW5mbyA9IHJlcXVpcmUoJ0RldmljZUluZm8nKTtcbiAgZGltcyA9IERldmljZUluZm8uRGltZW5zaW9ucztcbiAgbmF0aXZlRXh0ZW5zaW9uc0VuYWJsZWQgPSBmYWxzZTtcbn1cblxuaW52YXJpYW50KFxuICBkaW1zLFxuICAnRWl0aGVyIERldmljZUluZm8gbmF0aXZlIGV4dGVuc2lvbiBvciBEZXZpY2VJbmZvIE5hdGl2ZSBNb2R1bGUgbXVzdCBiZSByZWdpc3RlcmVkJyxcbik7XG5EaW1lbnNpb25zLnNldChkaW1zKTtcbmlmICghbmF0aXZlRXh0ZW5zaW9uc0VuYWJsZWQpIHtcbiAgUkNURGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKCdkaWRVcGRhdGVEaW1lbnNpb25zJywgZnVuY3Rpb24odXBkYXRlKSB7XG4gICAgRGltZW5zaW9ucy5zZXQodXBkYXRlKTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRGltZW5zaW9ucztcbiJdfQ==