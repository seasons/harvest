901edb4413b19ae3afafe8934b20201c
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _ = require("lodash");

var ComponentEventsObserver = function () {
  function ComponentEventsObserver(nativeEventsReceiver, store) {
    (0, _classCallCheck2.default)(this, ComponentEventsObserver);
    this.nativeEventsReceiver = nativeEventsReceiver;
    this.store = store;
    this.listeners = {};
    this.alreadyRegistered = false;
    this.notifyComponentDidAppear = this.notifyComponentDidAppear.bind(this);
    this.notifyComponentDidDisappear = this.notifyComponentDidDisappear.bind(this);
    this.notifyNavigationButtonPressed = this.notifyNavigationButtonPressed.bind(this);
    this.notifyModalDismissed = this.notifyModalDismissed.bind(this);
    this.notifySearchBarUpdated = this.notifySearchBarUpdated.bind(this);
    this.notifySearchBarCancelPressed = this.notifySearchBarCancelPressed.bind(this);
    this.notifyPreviewCompleted = this.notifyPreviewCompleted.bind(this);
  }

  (0, _createClass2.default)(ComponentEventsObserver, [{
    key: "registerOnceForAllComponentEvents",
    value: function registerOnceForAllComponentEvents() {
      if (this.alreadyRegistered) {
        return;
      }

      this.alreadyRegistered = true;
      this.nativeEventsReceiver.registerComponentDidAppearListener(this.notifyComponentDidAppear);
      this.nativeEventsReceiver.registerComponentDidDisappearListener(this.notifyComponentDidDisappear);
      this.nativeEventsReceiver.registerNavigationButtonPressedListener(this.notifyNavigationButtonPressed);
      this.nativeEventsReceiver.registerModalDismissedListener(this.notifyModalDismissed);
      this.nativeEventsReceiver.registerSearchBarUpdatedListener(this.notifySearchBarUpdated);
      this.nativeEventsReceiver.registerSearchBarCancelPressedListener(this.notifySearchBarCancelPressed);
      this.nativeEventsReceiver.registerPreviewCompletedListener(this.notifyPreviewCompleted);
    }
  }, {
    key: "bindComponent",
    value: function bindComponent(component, componentId) {
      var _this = this;

      var computedComponentId = componentId || component.props.componentId;

      if (!_.isString(computedComponentId)) {
        throw new Error("bindComponent expects a component with a componentId in props or a componentId as the second argument");
      }

      if (_.isNil(this.listeners[computedComponentId])) {
        this.listeners[computedComponentId] = {};
      }

      var key = _.uniqueId();

      this.listeners[computedComponentId][key] = component;
      return {
        remove: function remove() {
          return _.unset(_this.listeners[computedComponentId], key);
        }
      };
    }
  }, {
    key: "unmounted",
    value: function unmounted(componentId) {
      _.unset(this.listeners, componentId);
    }
  }, {
    key: "notifyComponentDidAppear",
    value: function notifyComponentDidAppear(event) {
      event.passProps = this.store.getPropsForId(event.componentId);
      this.triggerOnAllListenersByComponentId(event, 'componentDidAppear');
    }
  }, {
    key: "notifyComponentDidDisappear",
    value: function notifyComponentDidDisappear(event) {
      this.triggerOnAllListenersByComponentId(event, 'componentDidDisappear');
    }
  }, {
    key: "notifyNavigationButtonPressed",
    value: function notifyNavigationButtonPressed(event) {
      this.triggerOnAllListenersByComponentId(event, 'navigationButtonPressed');
    }
  }, {
    key: "notifyModalDismissed",
    value: function notifyModalDismissed(event) {
      this.triggerOnAllListenersByComponentId(event, 'modalDismissed');
    }
  }, {
    key: "notifySearchBarUpdated",
    value: function notifySearchBarUpdated(event) {
      this.triggerOnAllListenersByComponentId(event, 'searchBarUpdated');
    }
  }, {
    key: "notifySearchBarCancelPressed",
    value: function notifySearchBarCancelPressed(event) {
      this.triggerOnAllListenersByComponentId(event, 'searchBarCancelPressed');
    }
  }, {
    key: "notifyPreviewCompleted",
    value: function notifyPreviewCompleted(event) {
      this.triggerOnAllListenersByComponentId(event, 'previewCompleted');
    }
  }, {
    key: "triggerOnAllListenersByComponentId",
    value: function triggerOnAllListenersByComponentId(event, method) {
      _.forEach(this.listeners[event.componentId], function (component) {
        if (component && component[method]) {
          component[method](event);
        }
      });
    }
  }]);
  return ComponentEventsObserver;
}();

exports.ComponentEventsObserver = ComponentEventsObserver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbXBvbmVudEV2ZW50c09ic2VydmVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiXyIsInJlcXVpcmUiLCJDb21wb25lbnRFdmVudHNPYnNlcnZlciIsIm5hdGl2ZUV2ZW50c1JlY2VpdmVyIiwic3RvcmUiLCJsaXN0ZW5lcnMiLCJhbHJlYWR5UmVnaXN0ZXJlZCIsIm5vdGlmeUNvbXBvbmVudERpZEFwcGVhciIsImJpbmQiLCJub3RpZnlDb21wb25lbnREaWREaXNhcHBlYXIiLCJub3RpZnlOYXZpZ2F0aW9uQnV0dG9uUHJlc3NlZCIsIm5vdGlmeU1vZGFsRGlzbWlzc2VkIiwibm90aWZ5U2VhcmNoQmFyVXBkYXRlZCIsIm5vdGlmeVNlYXJjaEJhckNhbmNlbFByZXNzZWQiLCJub3RpZnlQcmV2aWV3Q29tcGxldGVkIiwicmVnaXN0ZXJDb21wb25lbnREaWRBcHBlYXJMaXN0ZW5lciIsInJlZ2lzdGVyQ29tcG9uZW50RGlkRGlzYXBwZWFyTGlzdGVuZXIiLCJyZWdpc3Rlck5hdmlnYXRpb25CdXR0b25QcmVzc2VkTGlzdGVuZXIiLCJyZWdpc3Rlck1vZGFsRGlzbWlzc2VkTGlzdGVuZXIiLCJyZWdpc3RlclNlYXJjaEJhclVwZGF0ZWRMaXN0ZW5lciIsInJlZ2lzdGVyU2VhcmNoQmFyQ2FuY2VsUHJlc3NlZExpc3RlbmVyIiwicmVnaXN0ZXJQcmV2aWV3Q29tcGxldGVkTGlzdGVuZXIiLCJjb21wb25lbnQiLCJjb21wb25lbnRJZCIsImNvbXB1dGVkQ29tcG9uZW50SWQiLCJwcm9wcyIsImlzU3RyaW5nIiwiRXJyb3IiLCJpc05pbCIsImtleSIsInVuaXF1ZUlkIiwicmVtb3ZlIiwidW5zZXQiLCJldmVudCIsInBhc3NQcm9wcyIsImdldFByb3BzRm9ySWQiLCJ0cmlnZ2VyT25BbGxMaXN0ZW5lcnNCeUNvbXBvbmVudElkIiwibWV0aG9kIiwiZm9yRWFjaCJdLCJtYXBwaW5ncyI6IkFBQUE7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XCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbmNsYXNzIENvbXBvbmVudEV2ZW50c09ic2VydmVyIHtcbiAgICBjb25zdHJ1Y3RvcihuYXRpdmVFdmVudHNSZWNlaXZlciwgc3RvcmUpIHtcbiAgICAgICAgdGhpcy5uYXRpdmVFdmVudHNSZWNlaXZlciA9IG5hdGl2ZUV2ZW50c1JlY2VpdmVyO1xuICAgICAgICB0aGlzLnN0b3JlID0gc3RvcmU7XG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XG4gICAgICAgIHRoaXMuYWxyZWFkeVJlZ2lzdGVyZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ub3RpZnlDb21wb25lbnREaWRBcHBlYXIgPSB0aGlzLm5vdGlmeUNvbXBvbmVudERpZEFwcGVhci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm5vdGlmeUNvbXBvbmVudERpZERpc2FwcGVhciA9IHRoaXMubm90aWZ5Q29tcG9uZW50RGlkRGlzYXBwZWFyLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMubm90aWZ5TmF2aWdhdGlvbkJ1dHRvblByZXNzZWQgPSB0aGlzLm5vdGlmeU5hdmlnYXRpb25CdXR0b25QcmVzc2VkLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMubm90aWZ5TW9kYWxEaXNtaXNzZWQgPSB0aGlzLm5vdGlmeU1vZGFsRGlzbWlzc2VkLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMubm90aWZ5U2VhcmNoQmFyVXBkYXRlZCA9IHRoaXMubm90aWZ5U2VhcmNoQmFyVXBkYXRlZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm5vdGlmeVNlYXJjaEJhckNhbmNlbFByZXNzZWQgPSB0aGlzLm5vdGlmeVNlYXJjaEJhckNhbmNlbFByZXNzZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5ub3RpZnlQcmV2aWV3Q29tcGxldGVkID0gdGhpcy5ub3RpZnlQcmV2aWV3Q29tcGxldGVkLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIHJlZ2lzdGVyT25jZUZvckFsbENvbXBvbmVudEV2ZW50cygpIHtcbiAgICAgICAgaWYgKHRoaXMuYWxyZWFkeVJlZ2lzdGVyZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFscmVhZHlSZWdpc3RlcmVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uYXRpdmVFdmVudHNSZWNlaXZlci5yZWdpc3RlckNvbXBvbmVudERpZEFwcGVhckxpc3RlbmVyKHRoaXMubm90aWZ5Q29tcG9uZW50RGlkQXBwZWFyKTtcbiAgICAgICAgdGhpcy5uYXRpdmVFdmVudHNSZWNlaXZlci5yZWdpc3RlckNvbXBvbmVudERpZERpc2FwcGVhckxpc3RlbmVyKHRoaXMubm90aWZ5Q29tcG9uZW50RGlkRGlzYXBwZWFyKTtcbiAgICAgICAgdGhpcy5uYXRpdmVFdmVudHNSZWNlaXZlci5yZWdpc3Rlck5hdmlnYXRpb25CdXR0b25QcmVzc2VkTGlzdGVuZXIodGhpcy5ub3RpZnlOYXZpZ2F0aW9uQnV0dG9uUHJlc3NlZCk7XG4gICAgICAgIHRoaXMubmF0aXZlRXZlbnRzUmVjZWl2ZXIucmVnaXN0ZXJNb2RhbERpc21pc3NlZExpc3RlbmVyKHRoaXMubm90aWZ5TW9kYWxEaXNtaXNzZWQpO1xuICAgICAgICB0aGlzLm5hdGl2ZUV2ZW50c1JlY2VpdmVyLnJlZ2lzdGVyU2VhcmNoQmFyVXBkYXRlZExpc3RlbmVyKHRoaXMubm90aWZ5U2VhcmNoQmFyVXBkYXRlZCk7XG4gICAgICAgIHRoaXMubmF0aXZlRXZlbnRzUmVjZWl2ZXIucmVnaXN0ZXJTZWFyY2hCYXJDYW5jZWxQcmVzc2VkTGlzdGVuZXIodGhpcy5ub3RpZnlTZWFyY2hCYXJDYW5jZWxQcmVzc2VkKTtcbiAgICAgICAgdGhpcy5uYXRpdmVFdmVudHNSZWNlaXZlci5yZWdpc3RlclByZXZpZXdDb21wbGV0ZWRMaXN0ZW5lcih0aGlzLm5vdGlmeVByZXZpZXdDb21wbGV0ZWQpO1xuICAgIH1cbiAgICBiaW5kQ29tcG9uZW50KGNvbXBvbmVudCwgY29tcG9uZW50SWQpIHtcbiAgICAgICAgY29uc3QgY29tcHV0ZWRDb21wb25lbnRJZCA9IGNvbXBvbmVudElkIHx8IGNvbXBvbmVudC5wcm9wcy5jb21wb25lbnRJZDtcbiAgICAgICAgaWYgKCFfLmlzU3RyaW5nKGNvbXB1dGVkQ29tcG9uZW50SWQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGJpbmRDb21wb25lbnQgZXhwZWN0cyBhIGNvbXBvbmVudCB3aXRoIGEgY29tcG9uZW50SWQgaW4gcHJvcHMgb3IgYSBjb21wb25lbnRJZCBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF8uaXNOaWwodGhpcy5saXN0ZW5lcnNbY29tcHV0ZWRDb21wb25lbnRJZF0pKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1tjb21wdXRlZENvbXBvbmVudElkXSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGtleSA9IF8udW5pcXVlSWQoKTtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnNbY29tcHV0ZWRDb21wb25lbnRJZF1ba2V5XSA9IGNvbXBvbmVudDtcbiAgICAgICAgcmV0dXJuIHsgcmVtb3ZlOiAoKSA9PiBfLnVuc2V0KHRoaXMubGlzdGVuZXJzW2NvbXB1dGVkQ29tcG9uZW50SWRdLCBrZXkpIH07XG4gICAgfVxuICAgIHVubW91bnRlZChjb21wb25lbnRJZCkge1xuICAgICAgICBfLnVuc2V0KHRoaXMubGlzdGVuZXJzLCBjb21wb25lbnRJZCk7XG4gICAgfVxuICAgIG5vdGlmeUNvbXBvbmVudERpZEFwcGVhcihldmVudCkge1xuICAgICAgICBldmVudC5wYXNzUHJvcHMgPSB0aGlzLnN0b3JlLmdldFByb3BzRm9ySWQoZXZlbnQuY29tcG9uZW50SWQpO1xuICAgICAgICB0aGlzLnRyaWdnZXJPbkFsbExpc3RlbmVyc0J5Q29tcG9uZW50SWQoZXZlbnQsICdjb21wb25lbnREaWRBcHBlYXInKTtcbiAgICB9XG4gICAgbm90aWZ5Q29tcG9uZW50RGlkRGlzYXBwZWFyKGV2ZW50KSB7XG4gICAgICAgIHRoaXMudHJpZ2dlck9uQWxsTGlzdGVuZXJzQnlDb21wb25lbnRJZChldmVudCwgJ2NvbXBvbmVudERpZERpc2FwcGVhcicpO1xuICAgIH1cbiAgICBub3RpZnlOYXZpZ2F0aW9uQnV0dG9uUHJlc3NlZChldmVudCkge1xuICAgICAgICB0aGlzLnRyaWdnZXJPbkFsbExpc3RlbmVyc0J5Q29tcG9uZW50SWQoZXZlbnQsICduYXZpZ2F0aW9uQnV0dG9uUHJlc3NlZCcpO1xuICAgIH1cbiAgICBub3RpZnlNb2RhbERpc21pc3NlZChldmVudCkge1xuICAgICAgICB0aGlzLnRyaWdnZXJPbkFsbExpc3RlbmVyc0J5Q29tcG9uZW50SWQoZXZlbnQsICdtb2RhbERpc21pc3NlZCcpO1xuICAgIH1cbiAgICBub3RpZnlTZWFyY2hCYXJVcGRhdGVkKGV2ZW50KSB7XG4gICAgICAgIHRoaXMudHJpZ2dlck9uQWxsTGlzdGVuZXJzQnlDb21wb25lbnRJZChldmVudCwgJ3NlYXJjaEJhclVwZGF0ZWQnKTtcbiAgICB9XG4gICAgbm90aWZ5U2VhcmNoQmFyQ2FuY2VsUHJlc3NlZChldmVudCkge1xuICAgICAgICB0aGlzLnRyaWdnZXJPbkFsbExpc3RlbmVyc0J5Q29tcG9uZW50SWQoZXZlbnQsICdzZWFyY2hCYXJDYW5jZWxQcmVzc2VkJyk7XG4gICAgfVxuICAgIG5vdGlmeVByZXZpZXdDb21wbGV0ZWQoZXZlbnQpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyT25BbGxMaXN0ZW5lcnNCeUNvbXBvbmVudElkKGV2ZW50LCAncHJldmlld0NvbXBsZXRlZCcpO1xuICAgIH1cbiAgICB0cmlnZ2VyT25BbGxMaXN0ZW5lcnNCeUNvbXBvbmVudElkKGV2ZW50LCBtZXRob2QpIHtcbiAgICAgICAgXy5mb3JFYWNoKHRoaXMubGlzdGVuZXJzW2V2ZW50LmNvbXBvbmVudElkXSwgKGNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudCAmJiBjb21wb25lbnRbbWV0aG9kXSkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudFttZXRob2RdKGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5Db21wb25lbnRFdmVudHNPYnNlcnZlciA9IENvbXBvbmVudEV2ZW50c09ic2VydmVyO1xuIl19