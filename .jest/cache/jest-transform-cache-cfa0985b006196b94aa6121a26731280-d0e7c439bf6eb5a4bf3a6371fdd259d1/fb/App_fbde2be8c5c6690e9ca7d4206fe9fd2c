c519c81c31e8fe81dd3507f989b4344d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.start = start;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _Bag = require("./Scenes/Bag");

var _Account = require("./Scenes/Account");

var _Home = require("./Scenes/Home");

var _Product = require("./Scenes/Product");

var _Browse = require("./Scenes/Browse");

var _reactNativeNavigation = require("react-native-navigation");

var _apolloClient = require("apollo-client");

var _reactHooks = require("@apollo/react-hooks");

var _apolloCacheInmemory = require("apollo-cache-inmemory");

var _apolloLinkHttp = require("apollo-link-http");

var _SignIn = require("./Scenes/SignIn");

var _StateProvider = require("./helpers/StateProvider");

var _asyncStorage = require("./helpers/asyncStorage");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var cache = new _apolloCacheInmemory.InMemoryCache();
var link = new _apolloLinkHttp.HttpLink({
  uri: "https://monsoon-staging.herokuapp.com"
});
var client = new _apolloClient.ApolloClient({
  cache: cache,
  link: link,
  name: "react-web-client",
  version: "1.3",
  queryDeduplication: false,
  defaultOptions: {
    watchQuery: {
      fetchPolicy: "cache-and-network"
    }
  }
});

var App = function App(Component, cacheData) {
  var initialState = cacheData;

  var reducer = function reducer(state, action) {
    var items = state.bag.items || [];

    switch (action.type) {
      case "addItemToBag":
        if (state.bag.items.includes(action.item)) {
          return;
        }

        items.push(action.item);

        var bagWithItem = _objectSpread({}, state, {
          bag: _objectSpread({}, state.bag, {
            items: items
          })
        });

        (0, _asyncStorage.persistCache)(bagWithItem);
        return bagWithItem;

      case "removeItemFromBag":
        var bagWithoutItem = _objectSpread({}, state, {
          bag: _objectSpread({}, state.bag, {
            items: items.filter(function (bagItem) {
              return bagItem.id === action.item.id;
            })
          })
        });

        (0, _asyncStorage.persistCache)(bagWithoutItem);
        return bagWithoutItem;

      default:
        return state;
    }
  };

  return function (props) {
    return _react.default.createElement(_reactHooks.ApolloProvider, {
      client: client
    }, _react.default.createElement(_StateProvider.StateProvider, {
      initialState: initialState,
      reducer: reducer
    }, _react.default.createElement(Component, props)));
  };
};

var registerNavigation = function registerNavigation(cacheData) {
  _reactNativeNavigation.Navigation.registerComponent("Initializing", function () {
    return App(_SignIn.Initializing, cacheData);
  }, function () {
    return _SignIn.Initializing;
  });

  _reactNativeNavigation.Navigation.registerComponent("Welcome", function () {
    return App(_SignIn.Welcome, cacheData);
  }, function () {
    return _SignIn.Welcome;
  });

  _reactNativeNavigation.Navigation.registerComponent("Notifications", function () {
    return App(_SignIn.Notifications, cacheData);
  }, function () {
    return _SignIn.Notifications;
  });

  _reactNativeNavigation.Navigation.registerComponent("Home", function () {
    return App(_Home.Home, cacheData);
  }, function () {
    return _Home.Home;
  });

  _reactNativeNavigation.Navigation.registerComponent("Product", function () {
    return App(_Product.Product, cacheData);
  }, function () {
    return _Product.Product;
  });

  _reactNativeNavigation.Navigation.registerComponent("SignIn", function () {
    return App(_SignIn.SignIn, cacheData);
  }, function () {
    return _SignIn.SignIn;
  });

  _reactNativeNavigation.Navigation.registerComponent("Browse", function () {
    return App(_Browse.Browse, cacheData);
  }, function () {
    return _Browse.Browse;
  });

  _reactNativeNavigation.Navigation.registerComponent("Bag", function () {
    return App(_Bag.Bag, cacheData);
  }, function () {
    return _Bag.Bag;
  });

  _reactNativeNavigation.Navigation.registerComponent("Account", function () {
    return App(_Account.Profile, cacheData);
  }, function () {
    return _Account.Profile;
  });

  _reactNativeNavigation.Navigation.registerComponent("Account.PaymentAndShipping", function () {
    return App(_Account.PaymentAndShipping, cacheData);
  }, function () {
    return _Account.PaymentAndShipping;
  });

  _reactNativeNavigation.Navigation.events().registerAppLaunchedListener(function _callee() {
    return _regenerator.default.async(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _reactNativeNavigation.Navigation.setDefaultOptions({
              layout: {
                componentBackgroundColor: "black",
                orientation: ["portrait"],
                direction: "ltr"
              },
              bottomTabs: {
                titleDisplayMode: "alwaysHide",
                backgroundColor: "black",
                hideShadow: true
              },
              bottomTab: {
                iconColor: "#4D4D4D",
                selectedIconColor: "#fff"
              },
              topBar: {
                visible: false
              }
            });

            _reactNativeNavigation.Navigation.setRoot({
              root: {
                component: {
                  name: "Initializing"
                }
              }
            });

          case 2:
          case "end":
            return _context.stop();
        }
      }
    });
  });
};

function start() {
  (0, _asyncStorage.restoreCache)().then(function (data) {
    return registerNavigation(data);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFwcC50c3giXSwibmFtZXMiOlsiY2FjaGUiLCJJbk1lbW9yeUNhY2hlIiwibGluayIsIkh0dHBMaW5rIiwidXJpIiwiY2xpZW50IiwiQXBvbGxvQ2xpZW50IiwibmFtZSIsInZlcnNpb24iLCJxdWVyeURlZHVwbGljYXRpb24iLCJkZWZhdWx0T3B0aW9ucyIsIndhdGNoUXVlcnkiLCJmZXRjaFBvbGljeSIsIkFwcCIsIkNvbXBvbmVudCIsImNhY2hlRGF0YSIsImluaXRpYWxTdGF0ZSIsInJlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsIml0ZW1zIiwiYmFnIiwidHlwZSIsImluY2x1ZGVzIiwiaXRlbSIsInB1c2giLCJiYWdXaXRoSXRlbSIsImJhZ1dpdGhvdXRJdGVtIiwiZmlsdGVyIiwiYmFnSXRlbSIsImlkIiwicHJvcHMiLCJyZWdpc3Rlck5hdmlnYXRpb24iLCJOYXZpZ2F0aW9uIiwicmVnaXN0ZXJDb21wb25lbnQiLCJJbml0aWFsaXppbmciLCJXZWxjb21lIiwiTm90aWZpY2F0aW9ucyIsIkhvbWUiLCJQcm9kdWN0IiwiU2lnbkluIiwiQnJvd3NlIiwiQmFnIiwiUHJvZmlsZSIsIlBheW1lbnRBbmRTaGlwcGluZyIsImV2ZW50cyIsInJlZ2lzdGVyQXBwTGF1bmNoZWRMaXN0ZW5lciIsInNldERlZmF1bHRPcHRpb25zIiwibGF5b3V0IiwiY29tcG9uZW50QmFja2dyb3VuZENvbG9yIiwib3JpZW50YXRpb24iLCJkaXJlY3Rpb24iLCJib3R0b21UYWJzIiwidGl0bGVEaXNwbGF5TW9kZSIsImJhY2tncm91bmRDb2xvciIsImhpZGVTaGFkb3ciLCJib3R0b21UYWIiLCJpY29uQ29sb3IiLCJzZWxlY3RlZEljb25Db2xvciIsInRvcEJhciIsInZpc2libGUiLCJzZXRSb290Iiwicm9vdCIsImNvbXBvbmVudCIsInN0YXJ0IiwidGhlbiIsImRhdGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUdBLElBQU1BLEtBQUssR0FBRyxJQUFJQyxrQ0FBSixFQUFkO0FBRUEsSUFBTUMsSUFBSSxHQUFHLElBQUlDLHdCQUFKLENBQWE7QUFDeEJDLEVBQUFBLEdBQUcsRUFBRTtBQURtQixDQUFiLENBQWI7QUFJQSxJQUFNQyxNQUFNLEdBQUcsSUFBSUMsMEJBQUosQ0FBaUI7QUFFOUJOLEVBQUFBLEtBQUssRUFBTEEsS0FGOEI7QUFHOUJFLEVBQUFBLElBQUksRUFBSkEsSUFIOEI7QUFLOUJLLEVBQUFBLElBQUksRUFBRSxrQkFMd0I7QUFNOUJDLEVBQUFBLE9BQU8sRUFBRSxLQU5xQjtBQU85QkMsRUFBQUEsa0JBQWtCLEVBQUUsS0FQVTtBQVE5QkMsRUFBQUEsY0FBYyxFQUFFO0FBQ2RDLElBQUFBLFVBQVUsRUFBRTtBQUNWQyxNQUFBQSxXQUFXLEVBQUU7QUFESDtBQURFO0FBUmMsQ0FBakIsQ0FBZjs7QUFnQkEsSUFBTUMsR0FBRyxHQUFHLFNBQU5BLEdBQU0sQ0FBQ0MsU0FBRCxFQUFpQ0MsU0FBakMsRUFBK0M7QUFDekQsTUFBTUMsWUFBWSxHQUFHRCxTQUFyQjs7QUFFQSxNQUFNRSxPQUFPLEdBQUcsU0FBVkEsT0FBVSxDQUFDQyxLQUFELEVBQVFDLE1BQVIsRUFBbUI7QUFDakMsUUFBTUMsS0FBSyxHQUFHRixLQUFLLENBQUNHLEdBQU4sQ0FBVUQsS0FBVixJQUFtQixFQUFqQzs7QUFDQSxZQUFRRCxNQUFNLENBQUNHLElBQWY7QUFDRSxXQUFLLGNBQUw7QUFDRSxZQUFJSixLQUFLLENBQUNHLEdBQU4sQ0FBVUQsS0FBVixDQUFnQkcsUUFBaEIsQ0FBeUJKLE1BQU0sQ0FBQ0ssSUFBaEMsQ0FBSixFQUEyQztBQUN6QztBQUNEOztBQUNESixRQUFBQSxLQUFLLENBQUNLLElBQU4sQ0FBV04sTUFBTSxDQUFDSyxJQUFsQjs7QUFDQSxZQUFNRSxXQUFXLHFCQUNaUixLQURZO0FBRWZHLFVBQUFBLEdBQUcsb0JBQU9ILEtBQUssQ0FBQ0csR0FBYjtBQUFrQkQsWUFBQUEsS0FBSyxFQUFMQTtBQUFsQjtBQUZZLFVBQWpCOztBQUlBLHdDQUFhTSxXQUFiO0FBQ0EsZUFBT0EsV0FBUDs7QUFDRixXQUFLLG1CQUFMO0FBQ0UsWUFBTUMsY0FBYyxxQkFDZlQsS0FEZTtBQUVsQkcsVUFBQUEsR0FBRyxvQkFBT0gsS0FBSyxDQUFDRyxHQUFiO0FBQWtCRCxZQUFBQSxLQUFLLEVBQUVBLEtBQUssQ0FBQ1EsTUFBTixDQUFhLFVBQUFDLE9BQU87QUFBQSxxQkFBSUEsT0FBTyxDQUFDQyxFQUFSLEtBQWVYLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZTSxFQUEvQjtBQUFBLGFBQXBCO0FBQXpCO0FBRmUsVUFBcEI7O0FBSUEsd0NBQWFILGNBQWI7QUFDQSxlQUFPQSxjQUFQOztBQUNGO0FBQ0UsZUFBT1QsS0FBUDtBQXBCSjtBQXNCRCxHQXhCRDs7QUEwQkEsU0FBTyxVQUFBYSxLQUFLO0FBQUEsV0FDViw2QkFBQywwQkFBRDtBQUFnQixNQUFBLE1BQU0sRUFBRTFCO0FBQXhCLE9BQ0UsNkJBQUMsNEJBQUQ7QUFBZSxNQUFBLFlBQVksRUFBRVcsWUFBN0I7QUFBMkMsTUFBQSxPQUFPLEVBQUVDO0FBQXBELE9BQ0UsNkJBQUMsU0FBRCxFQUFlYyxLQUFmLENBREYsQ0FERixDQURVO0FBQUEsR0FBWjtBQU9ELENBcENEOztBQXNDQSxJQUFNQyxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLENBQUFqQixTQUFTLEVBQUk7QUFDdENrQixvQ0FBV0MsaUJBQVgsQ0FBNkIsY0FBN0IsRUFBNkM7QUFBQSxXQUFNckIsR0FBRyxDQUFDc0Isb0JBQUQsRUFBZXBCLFNBQWYsQ0FBVDtBQUFBLEdBQTdDLEVBQWlGO0FBQUEsV0FBTW9CLG9CQUFOO0FBQUEsR0FBakY7O0FBQ0FGLG9DQUFXQyxpQkFBWCxDQUE2QixTQUE3QixFQUF3QztBQUFBLFdBQU1yQixHQUFHLENBQUN1QixlQUFELEVBQVVyQixTQUFWLENBQVQ7QUFBQSxHQUF4QyxFQUF1RTtBQUFBLFdBQU1xQixlQUFOO0FBQUEsR0FBdkU7O0FBQ0FILG9DQUFXQyxpQkFBWCxDQUE2QixlQUE3QixFQUE4QztBQUFBLFdBQU1yQixHQUFHLENBQUN3QixxQkFBRCxFQUFnQnRCLFNBQWhCLENBQVQ7QUFBQSxHQUE5QyxFQUFtRjtBQUFBLFdBQU1zQixxQkFBTjtBQUFBLEdBQW5GOztBQUNBSixvQ0FBV0MsaUJBQVgsQ0FBNkIsTUFBN0IsRUFBcUM7QUFBQSxXQUFNckIsR0FBRyxDQUFDeUIsVUFBRCxFQUFPdkIsU0FBUCxDQUFUO0FBQUEsR0FBckMsRUFBaUU7QUFBQSxXQUFNdUIsVUFBTjtBQUFBLEdBQWpFOztBQUNBTCxvQ0FBV0MsaUJBQVgsQ0FBNkIsU0FBN0IsRUFBd0M7QUFBQSxXQUFNckIsR0FBRyxDQUFDMEIsZ0JBQUQsRUFBVXhCLFNBQVYsQ0FBVDtBQUFBLEdBQXhDLEVBQXVFO0FBQUEsV0FBTXdCLGdCQUFOO0FBQUEsR0FBdkU7O0FBQ0FOLG9DQUFXQyxpQkFBWCxDQUE2QixRQUE3QixFQUF1QztBQUFBLFdBQU1yQixHQUFHLENBQUMyQixjQUFELEVBQVN6QixTQUFULENBQVQ7QUFBQSxHQUF2QyxFQUFxRTtBQUFBLFdBQU15QixjQUFOO0FBQUEsR0FBckU7O0FBQ0FQLG9DQUFXQyxpQkFBWCxDQUE2QixRQUE3QixFQUF1QztBQUFBLFdBQU1yQixHQUFHLENBQUM0QixjQUFELEVBQVMxQixTQUFULENBQVQ7QUFBQSxHQUF2QyxFQUFxRTtBQUFBLFdBQU0wQixjQUFOO0FBQUEsR0FBckU7O0FBQ0FSLG9DQUFXQyxpQkFBWCxDQUE2QixLQUE3QixFQUFvQztBQUFBLFdBQU1yQixHQUFHLENBQUM2QixRQUFELEVBQU0zQixTQUFOLENBQVQ7QUFBQSxHQUFwQyxFQUErRDtBQUFBLFdBQU0yQixRQUFOO0FBQUEsR0FBL0Q7O0FBQ0FULG9DQUFXQyxpQkFBWCxDQUE2QixTQUE3QixFQUF3QztBQUFBLFdBQU1yQixHQUFHLENBQUM4QixnQkFBRCxFQUFVNUIsU0FBVixDQUFUO0FBQUEsR0FBeEMsRUFBdUU7QUFBQSxXQUFNNEIsZ0JBQU47QUFBQSxHQUF2RTs7QUFDQVYsb0NBQVdDLGlCQUFYLENBQ0UsNEJBREYsRUFFRTtBQUFBLFdBQU1yQixHQUFHLENBQUMrQiwyQkFBRCxFQUFxQjdCLFNBQXJCLENBQVQ7QUFBQSxHQUZGLEVBR0U7QUFBQSxXQUFNNkIsMkJBQU47QUFBQSxHQUhGOztBQU1BWCxvQ0FBV1ksTUFBWCxHQUFvQkMsMkJBQXBCLENBQWdEO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDOUNiLDhDQUFXYyxpQkFBWCxDQUE2QjtBQUMzQkMsY0FBQUEsTUFBTSxFQUFFO0FBQ05DLGdCQUFBQSx3QkFBd0IsRUFBRSxPQURwQjtBQUVOQyxnQkFBQUEsV0FBVyxFQUFFLENBQUMsVUFBRCxDQUZQO0FBR05DLGdCQUFBQSxTQUFTLEVBQUU7QUFITCxlQURtQjtBQU0zQkMsY0FBQUEsVUFBVSxFQUFFO0FBQ1ZDLGdCQUFBQSxnQkFBZ0IsRUFBRSxZQURSO0FBRVZDLGdCQUFBQSxlQUFlLEVBQUUsT0FGUDtBQUdWQyxnQkFBQUEsVUFBVSxFQUFFO0FBSEYsZUFOZTtBQVczQkMsY0FBQUEsU0FBUyxFQUFFO0FBQ1RDLGdCQUFBQSxTQUFTLEVBQUUsU0FERjtBQUVUQyxnQkFBQUEsaUJBQWlCLEVBQUU7QUFGVixlQVhnQjtBQWUzQkMsY0FBQUEsTUFBTSxFQUFFO0FBQ05DLGdCQUFBQSxPQUFPLEVBQUU7QUFESDtBQWZtQixhQUE3Qjs7QUFvQkEzQiw4Q0FBVzRCLE9BQVgsQ0FBbUI7QUFDakJDLGNBQUFBLElBQUksRUFBRTtBQUNKQyxnQkFBQUEsU0FBUyxFQUFFO0FBQ1R4RCxrQkFBQUEsSUFBSSxFQUFFO0FBREc7QUFEUDtBQURXLGFBQW5COztBQXJCOEM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FBaEQ7QUE2QkQsQ0E3Q0Q7O0FBK0NPLFNBQVN5RCxLQUFULEdBQWlCO0FBQ3RCLG9DQUFlQyxJQUFmLENBQW9CLFVBQUFDLElBQUk7QUFBQSxXQUFJbEMsa0JBQWtCLENBQUNrQyxJQUFELENBQXRCO0FBQUEsR0FBeEI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHsgQmFnIH0gZnJvbSBcIlNjZW5lcy9CYWdcIlxuaW1wb3J0IHsgUHJvZmlsZSwgUGF5bWVudEFuZFNoaXBwaW5nIH0gZnJvbSBcIlNjZW5lcy9BY2NvdW50XCJcbmltcG9ydCB7IEhvbWUgfSBmcm9tIFwiU2NlbmVzL0hvbWVcIlxuaW1wb3J0IHsgUHJvZHVjdCB9IGZyb20gXCJTY2VuZXMvUHJvZHVjdFwiXG5pbXBvcnQgeyBCcm93c2UgfSBmcm9tIFwiU2NlbmVzL0Jyb3dzZVwiXG5pbXBvcnQgeyBOYXZpZ2F0aW9uIH0gZnJvbSBcInJlYWN0LW5hdGl2ZS1uYXZpZ2F0aW9uXCJcbmltcG9ydCB7IEFwb2xsb0NsaWVudCB9IGZyb20gXCJhcG9sbG8tY2xpZW50XCJcbmltcG9ydCB7IEFwb2xsb1Byb3ZpZGVyIH0gZnJvbSBcIkBhcG9sbG8vcmVhY3QtaG9va3NcIlxuaW1wb3J0IHsgSW5NZW1vcnlDYWNoZSB9IGZyb20gXCJhcG9sbG8tY2FjaGUtaW5tZW1vcnlcIlxuaW1wb3J0IHsgSHR0cExpbmsgfSBmcm9tIFwiYXBvbGxvLWxpbmstaHR0cFwiXG5pbXBvcnQgeyBTaWduSW4sIFdlbGNvbWUsIEluaXRpYWxpemluZywgTm90aWZpY2F0aW9ucyB9IGZyb20gXCJTY2VuZXMvU2lnbkluXCJcbmltcG9ydCB7IFN0YXRlUHJvdmlkZXIgfSBmcm9tIFwiQXBwL2hlbHBlcnMvU3RhdGVQcm92aWRlclwiXG5pbXBvcnQgeyByZXN0b3JlQ2FjaGUsIHBlcnNpc3RDYWNoZSB9IGZyb20gXCIuL2hlbHBlcnMvYXN5bmNTdG9yYWdlXCJcblxuLy8gSW5zdGFudGlhdGUgcmVxdWlyZWQgY29uc3RydWN0b3IgZmllbGRzXG5jb25zdCBjYWNoZSA9IG5ldyBJbk1lbW9yeUNhY2hlKClcblxuY29uc3QgbGluayA9IG5ldyBIdHRwTGluayh7XG4gIHVyaTogXCJodHRwczovL21vbnNvb24tc3RhZ2luZy5oZXJva3VhcHAuY29tXCIsXG59KVxuXG5jb25zdCBjbGllbnQgPSBuZXcgQXBvbGxvQ2xpZW50KHtcbiAgLy8gUHJvdmlkZSByZXF1aXJlZCBjb25zdHJ1Y3RvciBmaWVsZHNcbiAgY2FjaGUsXG4gIGxpbmssXG4gIC8vIFByb3ZpZGUgc29tZSBvcHRpb25hbCBjb25zdHJ1Y3RvciBmaWVsZHNcbiAgbmFtZTogXCJyZWFjdC13ZWItY2xpZW50XCIsXG4gIHZlcnNpb246IFwiMS4zXCIsXG4gIHF1ZXJ5RGVkdXBsaWNhdGlvbjogZmFsc2UsXG4gIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgd2F0Y2hRdWVyeToge1xuICAgICAgZmV0Y2hQb2xpY3k6IFwiY2FjaGUtYW5kLW5ldHdvcmtcIixcbiAgICB9LFxuICB9LFxufSlcblxuLy8gQ3JlYXRlIHRoZSBjbGllbnQgYXMgb3V0bGluZWQgaW4gdGhlIHNldHVwIGd1aWRlXG5jb25zdCBBcHAgPSAoQ29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlLCBjYWNoZURhdGEpID0+IHtcbiAgY29uc3QgaW5pdGlhbFN0YXRlID0gY2FjaGVEYXRhXG5cbiAgY29uc3QgcmVkdWNlciA9IChzdGF0ZSwgYWN0aW9uKSA9PiB7XG4gICAgY29uc3QgaXRlbXMgPSBzdGF0ZS5iYWcuaXRlbXMgfHwgW11cbiAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICBjYXNlIFwiYWRkSXRlbVRvQmFnXCI6XG4gICAgICAgIGlmIChzdGF0ZS5iYWcuaXRlbXMuaW5jbHVkZXMoYWN0aW9uLml0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgaXRlbXMucHVzaChhY3Rpb24uaXRlbSlcbiAgICAgICAgY29uc3QgYmFnV2l0aEl0ZW0gPSB7XG4gICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgYmFnOiB7IC4uLnN0YXRlLmJhZywgaXRlbXMgfSxcbiAgICAgICAgfVxuICAgICAgICBwZXJzaXN0Q2FjaGUoYmFnV2l0aEl0ZW0pXG4gICAgICAgIHJldHVybiBiYWdXaXRoSXRlbVxuICAgICAgY2FzZSBcInJlbW92ZUl0ZW1Gcm9tQmFnXCI6XG4gICAgICAgIGNvbnN0IGJhZ1dpdGhvdXRJdGVtID0ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIGJhZzogeyAuLi5zdGF0ZS5iYWcsIGl0ZW1zOiBpdGVtcy5maWx0ZXIoYmFnSXRlbSA9PiBiYWdJdGVtLmlkID09PSBhY3Rpb24uaXRlbS5pZCkgfSxcbiAgICAgICAgfVxuICAgICAgICBwZXJzaXN0Q2FjaGUoYmFnV2l0aG91dEl0ZW0pXG4gICAgICAgIHJldHVybiBiYWdXaXRob3V0SXRlbVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHN0YXRlXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHByb3BzID0+IChcbiAgICA8QXBvbGxvUHJvdmlkZXIgY2xpZW50PXtjbGllbnR9PlxuICAgICAgPFN0YXRlUHJvdmlkZXIgaW5pdGlhbFN0YXRlPXtpbml0aWFsU3RhdGV9IHJlZHVjZXI9e3JlZHVjZXJ9PlxuICAgICAgICA8Q29tcG9uZW50IHsuLi5wcm9wc30gLz5cbiAgICAgIDwvU3RhdGVQcm92aWRlcj5cbiAgICA8L0Fwb2xsb1Byb3ZpZGVyPlxuICApXG59XG5cbmNvbnN0IHJlZ2lzdGVyTmF2aWdhdGlvbiA9IGNhY2hlRGF0YSA9PiB7XG4gIE5hdmlnYXRpb24ucmVnaXN0ZXJDb21wb25lbnQoXCJJbml0aWFsaXppbmdcIiwgKCkgPT4gQXBwKEluaXRpYWxpemluZywgY2FjaGVEYXRhKSwgKCkgPT4gSW5pdGlhbGl6aW5nKVxuICBOYXZpZ2F0aW9uLnJlZ2lzdGVyQ29tcG9uZW50KFwiV2VsY29tZVwiLCAoKSA9PiBBcHAoV2VsY29tZSwgY2FjaGVEYXRhKSwgKCkgPT4gV2VsY29tZSlcbiAgTmF2aWdhdGlvbi5yZWdpc3RlckNvbXBvbmVudChcIk5vdGlmaWNhdGlvbnNcIiwgKCkgPT4gQXBwKE5vdGlmaWNhdGlvbnMsIGNhY2hlRGF0YSksICgpID0+IE5vdGlmaWNhdGlvbnMpXG4gIE5hdmlnYXRpb24ucmVnaXN0ZXJDb21wb25lbnQoXCJIb21lXCIsICgpID0+IEFwcChIb21lLCBjYWNoZURhdGEpLCAoKSA9PiBIb21lKVxuICBOYXZpZ2F0aW9uLnJlZ2lzdGVyQ29tcG9uZW50KFwiUHJvZHVjdFwiLCAoKSA9PiBBcHAoUHJvZHVjdCwgY2FjaGVEYXRhKSwgKCkgPT4gUHJvZHVjdClcbiAgTmF2aWdhdGlvbi5yZWdpc3RlckNvbXBvbmVudChcIlNpZ25JblwiLCAoKSA9PiBBcHAoU2lnbkluLCBjYWNoZURhdGEpLCAoKSA9PiBTaWduSW4pXG4gIE5hdmlnYXRpb24ucmVnaXN0ZXJDb21wb25lbnQoXCJCcm93c2VcIiwgKCkgPT4gQXBwKEJyb3dzZSwgY2FjaGVEYXRhKSwgKCkgPT4gQnJvd3NlKVxuICBOYXZpZ2F0aW9uLnJlZ2lzdGVyQ29tcG9uZW50KFwiQmFnXCIsICgpID0+IEFwcChCYWcsIGNhY2hlRGF0YSksICgpID0+IEJhZylcbiAgTmF2aWdhdGlvbi5yZWdpc3RlckNvbXBvbmVudChcIkFjY291bnRcIiwgKCkgPT4gQXBwKFByb2ZpbGUsIGNhY2hlRGF0YSksICgpID0+IFByb2ZpbGUpXG4gIE5hdmlnYXRpb24ucmVnaXN0ZXJDb21wb25lbnQoXG4gICAgXCJBY2NvdW50LlBheW1lbnRBbmRTaGlwcGluZ1wiLFxuICAgICgpID0+IEFwcChQYXltZW50QW5kU2hpcHBpbmcsIGNhY2hlRGF0YSksXG4gICAgKCkgPT4gUGF5bWVudEFuZFNoaXBwaW5nXG4gIClcblxuICBOYXZpZ2F0aW9uLmV2ZW50cygpLnJlZ2lzdGVyQXBwTGF1bmNoZWRMaXN0ZW5lcihhc3luYyAoKSA9PiB7XG4gICAgTmF2aWdhdGlvbi5zZXREZWZhdWx0T3B0aW9ucyh7XG4gICAgICBsYXlvdXQ6IHtcbiAgICAgICAgY29tcG9uZW50QmFja2dyb3VuZENvbG9yOiBcImJsYWNrXCIsXG4gICAgICAgIG9yaWVudGF0aW9uOiBbXCJwb3J0cmFpdFwiXSxcbiAgICAgICAgZGlyZWN0aW9uOiBcImx0clwiLFxuICAgICAgfSxcbiAgICAgIGJvdHRvbVRhYnM6IHtcbiAgICAgICAgdGl0bGVEaXNwbGF5TW9kZTogXCJhbHdheXNIaWRlXCIsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogXCJibGFja1wiLFxuICAgICAgICBoaWRlU2hhZG93OiB0cnVlLFxuICAgICAgfSxcbiAgICAgIGJvdHRvbVRhYjoge1xuICAgICAgICBpY29uQ29sb3I6IFwiIzRENEQ0RFwiLFxuICAgICAgICBzZWxlY3RlZEljb25Db2xvcjogXCIjZmZmXCIsXG4gICAgICB9LFxuICAgICAgdG9wQmFyOiB7XG4gICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgTmF2aWdhdGlvbi5zZXRSb290KHtcbiAgICAgIHJvb3Q6IHtcbiAgICAgICAgY29tcG9uZW50OiB7XG4gICAgICAgICAgbmFtZTogXCJJbml0aWFsaXppbmdcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSlcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICByZXN0b3JlQ2FjaGUoKS50aGVuKGRhdGEgPT4gcmVnaXN0ZXJOYXZpZ2F0aW9uKGRhdGEpKVxufVxuIl19