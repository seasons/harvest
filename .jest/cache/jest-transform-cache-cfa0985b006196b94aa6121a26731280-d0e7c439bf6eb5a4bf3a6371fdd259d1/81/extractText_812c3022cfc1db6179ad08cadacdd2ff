55c44d18918bf65f17e0d3b29f939325
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.extractFont = extractFont;
exports.setTSpan = setTSpan;
exports.default = extractText;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _extractLengthList = _interopRequireDefault(require("./extractLengthList"));

var _util = require("../util");

var _jsxFileName = "/Users/jannegylling/IdeaProjects/react-native-svg/src/lib/extract/extractText.tsx";

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(source, true).forEach(function (key) {
        (0, _defineProperty2.default)(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(source).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

var fontRegExp = /^\s*((?:(?:normal|bold|italic)\s+)*)(?:(\d+(?:\.\d+)?(?:%|px|em|pt|pc|mm|cm|in]))*(?:\s*\/.*?)?\s+)?\s*"?([^"]*)/i;
var fontFamilyPrefix = /^[\s"']*/;
var fontFamilySuffix = /[\s"']*$/;
var commaReg = /\s*,\s*/g;
var cachedFontObjectsFromString = {};

function extractSingleFontFamily(fontFamilyString) {
  return fontFamilyString ? fontFamilyString.split(commaReg)[0].replace(fontFamilyPrefix, '').replace(fontFamilySuffix, '') : null;
}

function parseFontString(font) {
  if (cachedFontObjectsFromString.hasOwnProperty(font)) {
    return cachedFontObjectsFromString[font];
  }

  var match = fontRegExp.exec(font);

  if (!match) {
    cachedFontObjectsFromString[font] = null;
    return null;
  }

  var isBold = /bold/.exec(match[1]);
  var isItalic = /italic/.exec(match[1]);
  cachedFontObjectsFromString[font] = {
    fontSize: match[2] || 12,
    fontWeight: isBold ? 'bold' : 'normal',
    fontStyle: isItalic ? 'italic' : 'normal',
    fontFamily: extractSingleFontFamily(match[3])
  };
  return cachedFontObjectsFromString[font];
}

function extractFont(props) {
  var fontData = props.fontData,
      fontStyle = props.fontStyle,
      fontVariant = props.fontVariant,
      fontWeight = props.fontWeight,
      fontStretch = props.fontStretch,
      fontSize = props.fontSize,
      fontFamily = props.fontFamily,
      textAnchor = props.textAnchor,
      textDecoration = props.textDecoration,
      letterSpacing = props.letterSpacing,
      wordSpacing = props.wordSpacing,
      kerning = props.kerning,
      fontFeatureSettings = props.fontFeatureSettings,
      fontVariantLigatures = props.fontVariantLigatures,
      fontVariationSettings = props.fontVariationSettings,
      font = props.font;
  var ownedFont = (0, _util.pickNotNil)({
    fontData: fontData,
    fontStyle: fontStyle,
    fontVariant: fontVariant,
    fontWeight: fontWeight,
    fontStretch: fontStretch,
    fontSize: fontSize,
    fontFamily: extractSingleFontFamily(fontFamily),
    textAnchor: textAnchor,
    textDecoration: textDecoration,
    letterSpacing: letterSpacing,
    wordSpacing: wordSpacing,
    kerning: kerning,
    fontFeatureSettings: fontFeatureSettings,
    fontVariantLigatures: fontVariantLigatures,
    fontVariationSettings: fontVariationSettings
  });
  var baseFont = typeof font === 'string' ? parseFontString(font) : font;
  return _objectSpread({}, baseFont, {}, ownedFont);
}

var TSpan;

function setTSpan(TSpanImplementation) {
  TSpan = TSpanImplementation;
}

function getChild(child) {
  if (typeof child === 'string' || typeof child === 'number') {
    return _react.default.createElement(TSpan, {
      __source: {
        fileName: _jsxFileName,
        lineNumber: 122
      }
    }, String(child));
  } else {
    return child;
  }
}

function extractText(props, container) {
  var x = props.x,
      y = props.y,
      dx = props.dx,
      dy = props.dy,
      rotate = props.rotate,
      children = props.children,
      inlineSize = props.inlineSize,
      baselineShift = props.baselineShift,
      verticalAlign = props.verticalAlign,
      alignmentBaseline = props.alignmentBaseline;
  var textChildren = typeof children === 'string' || typeof children === 'number' ? container ? _react.default.createElement(TSpan, {
    __source: {
      fileName: _jsxFileName,
      lineNumber: 158
    }
  }, String(children)) : null : _react.Children.count(children) > 1 || Array.isArray(children) ? _react.Children.map(children, getChild) : children;
  return {
    content: textChildren === null ? String(children) : null,
    children: textChildren,
    inlineSize: inlineSize,
    baselineShift: baselineShift,
    verticalAlign: verticalAlign,
    alignmentBaseline: alignmentBaseline,
    font: extractFont(props),
    x: (0, _extractLengthList.default)(x),
    y: (0, _extractLengthList.default)(y),
    dx: (0, _extractLengthList.default)(dx),
    dy: (0, _extractLengthList.default)(dy),
    rotate: (0, _extractLengthList.default)(rotate)
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dHJhY3RUZXh0LnRzeCJdLCJuYW1lcyI6WyJmb250UmVnRXhwIiwiZm9udEZhbWlseVByZWZpeCIsImZvbnRGYW1pbHlTdWZmaXgiLCJjb21tYVJlZyIsImNhY2hlZEZvbnRPYmplY3RzRnJvbVN0cmluZyIsImZvbnRGYW1pbHlTdHJpbmciLCJtYXRjaCIsImlzQm9sZCIsImlzSXRhbGljIiwiZm9udFNpemUiLCJmb250V2VpZ2h0IiwiZm9udFN0eWxlIiwiZm9udEZhbWlseSIsImV4dHJhY3RTaW5nbGVGb250RmFtaWx5IiwiZm9udERhdGEiLCJmb250VmFyaWFudCIsImZvbnRTdHJldGNoIiwidGV4dEFuY2hvciIsInRleHREZWNvcmF0aW9uIiwibGV0dGVyU3BhY2luZyIsIndvcmRTcGFjaW5nIiwia2VybmluZyIsImZvbnRGZWF0dXJlU2V0dGluZ3MiLCJmb250VmFyaWFudExpZ2F0dXJlcyIsImZvbnRWYXJpYXRpb25TZXR0aW5ncyIsImZvbnQiLCJwcm9wcyIsIm93bmVkRm9udCIsImJhc2VGb250IiwicGFyc2VGb250U3RyaW5nIiwiVFNwYW4iLCJTdHJpbmciLCJ4IiwieSIsImR4IiwiZHkiLCJyb3RhdGUiLCJjaGlsZHJlbiIsImlubGluZVNpemUiLCJiYXNlbGluZVNoaWZ0IiwidmVydGljYWxBbGlnbiIsImFsaWdubWVudEJhc2VsaW5lIiwidGV4dENoaWxkcmVuIiwiY29udGFpbmVyIiwiQ2hpbGRyZW4iLCJBcnJheSIsImNvbnRlbnQiLCJleHRyYWN0Rm9udCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsa0JBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsdUJBQUEsQ0FBQTs7QUFDQSxJQUFBLEtBQUEsR0FBQSxPQUFBLFdBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUFBLElB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QUFBQSxDQUFBQSxJQUFnQ0MsS0FBSyxDQUFMQSxPQUFBQSxDQUFoQ0QsUUFBZ0NDLENBQWhDRCxHQUNGQSxNQUFBQSxDQUFBQSxRQUFBQSxDQUFBQSxHQUFBQSxDQUFBQSxRQUFBQSxFQURFQSxRQUNGQSxDQURFQSxHQUxOLFFBQUE7QUFXQSxTQUFPO0FBQ0xFLElBQUFBLE9BQU8sRUFBRUosWUFBWSxLQUFaQSxJQUFBQSxHQUF3QlgsTUFBTSxDQUE5QlcsUUFBOEIsQ0FBOUJBLEdBREosSUFBQTtBQUVMTCxJQUFBQSxRQUFRLEVBRkgsWUFBQTtBQUdMQyxJQUFBQSxVQUFVLEVBSEwsVUFBQTtBQUlMQyxJQUFBQSxhQUFhLEVBSlIsYUFBQTtBQUtMQyxJQUFBQSxhQUFhLEVBTFIsYUFBQTtBQU1MQyxJQUFBQSxpQkFBaUIsRUFOWixpQkFBQTtBQU9MaEIsSUFBQUEsSUFBSSxFQUFFc0IsV0FBVyxDQVBaLEtBT1ksQ0FQWjtBQVFMZixJQUFBQSxDQUFDLEVBQUUsQ0FBQSxHQUFBLGtCQUFBLENBQUEsT0FBQSxFQVJFLENBUUYsQ0FSRTtBQVNMQyxJQUFBQSxDQUFDLEVBQUUsQ0FBQSxHQUFBLGtCQUFBLENBQUEsT0FBQSxFQVRFLENBU0YsQ0FURTtBQVVMQyxJQUFBQSxFQUFFLEVBQUUsQ0FBQSxHQUFBLGtCQUFBLENBQUEsT0FBQSxFQVZDLEVBVUQsQ0FWQztBQVdMQyxJQUFBQSxFQUFFLEVBQUUsQ0FBQSxHQUFBLGtCQUFBLENBQUEsT0FBQSxFQVhDLEVBV0QsQ0FYQztBQVlMQyxJQUFBQSxNQUFNLEVBQUUsQ0FBQSxHQUFBLGtCQUFBLENBQUEsT0FBQSxFQVpWLE1BWVU7QUFaSCxHQUFQO0FBY0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ2hpbGRyZW4sIENvbXBvbmVudFR5cGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgZXh0cmFjdExlbmd0aExpc3QgZnJvbSAnLi9leHRyYWN0TGVuZ3RoTGlzdCc7XG5pbXBvcnQgeyBwaWNrTm90TmlsIH0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQgeyBOdW1iZXJBcnJheSwgTnVtYmVyUHJvcCB9IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBmb250UmVnRXhwID0gL15cXHMqKCg/Oig/Om5vcm1hbHxib2xkfGl0YWxpYylcXHMrKSopKD86KFxcZCsoPzpcXC5cXGQrKT8oPzolfHB4fGVtfHB0fHBjfG1tfGNtfGluXSkpKig/OlxccypcXC8uKj8pP1xccyspP1xccypcIj8oW15cIl0qKS9pO1xuY29uc3QgZm9udEZhbWlseVByZWZpeCA9IC9eW1xcc1wiJ10qLztcbmNvbnN0IGZvbnRGYW1pbHlTdWZmaXggPSAvW1xcc1wiJ10qJC87XG5jb25zdCBjb21tYVJlZyA9IC9cXHMqLFxccyovZztcblxuY29uc3QgY2FjaGVkRm9udE9iamVjdHNGcm9tU3RyaW5nOiB7XG4gIFtmb250OiBzdHJpbmddOiB7XG4gICAgZm9udFN0eWxlOiBzdHJpbmc7XG4gICAgZm9udFNpemU6IE51bWJlclByb3A7XG4gICAgZm9udFdlaWdodDogTnVtYmVyUHJvcDtcbiAgICBmb250RmFtaWx5OiBzdHJpbmcgfCBudWxsO1xuICB9IHwgbnVsbDtcbn0gPSB7fTtcblxuZnVuY3Rpb24gZXh0cmFjdFNpbmdsZUZvbnRGYW1pbHkoZm9udEZhbWlseVN0cmluZz86IHN0cmluZykge1xuICAvLyBTVkcgb24gdGhlIHdlYiBhbGxvd3MgZm9yIG11bHRpcGxlIGZvbnQtZmFtaWxpZXMgdG8gYmUgc3BlY2lmaWVkLlxuICAvLyBGb3IgY29tcGF0aWJpbGl0eSwgd2UgZXh0cmFjdCB0aGUgZmlyc3QgZm9udC1mYW1pbHksIGhvcGluZ1xuICAvLyB3ZSdsbCBnZXQgYSBtYXRjaC5cbiAgcmV0dXJuIGZvbnRGYW1pbHlTdHJpbmdcbiAgICA/IGZvbnRGYW1pbHlTdHJpbmdcbiAgICAgICAgLnNwbGl0KGNvbW1hUmVnKVswXVxuICAgICAgICAucmVwbGFjZShmb250RmFtaWx5UHJlZml4LCAnJylcbiAgICAgICAgLnJlcGxhY2UoZm9udEZhbWlseVN1ZmZpeCwgJycpXG4gICAgOiBudWxsO1xufVxuXG5mdW5jdGlvbiBwYXJzZUZvbnRTdHJpbmcoZm9udDogc3RyaW5nKSB7XG4gIGlmIChjYWNoZWRGb250T2JqZWN0c0Zyb21TdHJpbmcuaGFzT3duUHJvcGVydHkoZm9udCkpIHtcbiAgICByZXR1cm4gY2FjaGVkRm9udE9iamVjdHNGcm9tU3RyaW5nW2ZvbnRdO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gZm9udFJlZ0V4cC5leGVjKGZvbnQpO1xuICBpZiAoIW1hdGNoKSB7XG4gICAgY2FjaGVkRm9udE9iamVjdHNGcm9tU3RyaW5nW2ZvbnRdID0gbnVsbDtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBpc0JvbGQgPSAvYm9sZC8uZXhlYyhtYXRjaFsxXSk7XG4gIGNvbnN0IGlzSXRhbGljID0gL2l0YWxpYy8uZXhlYyhtYXRjaFsxXSk7XG4gIGNhY2hlZEZvbnRPYmplY3RzRnJvbVN0cmluZ1tmb250XSA9IHtcbiAgICBmb250U2l6ZTogbWF0Y2hbMl0gfHwgMTIsXG4gICAgZm9udFdlaWdodDogaXNCb2xkID8gJ2JvbGQnIDogJ25vcm1hbCcsXG4gICAgZm9udFN0eWxlOiBpc0l0YWxpYyA/ICdpdGFsaWMnIDogJ25vcm1hbCcsXG4gICAgZm9udEZhbWlseTogZXh0cmFjdFNpbmdsZUZvbnRGYW1pbHkobWF0Y2hbM10pLFxuICB9O1xuICByZXR1cm4gY2FjaGVkRm9udE9iamVjdHNGcm9tU3RyaW5nW2ZvbnRdO1xufVxuXG5pbnRlcmZhY2UgZm9udFByb3BzIHtcbiAgZm9udERhdGE/OiB1bmtub3duO1xuICBmb250U3R5bGU/OiBzdHJpbmc7XG4gIGZvbnRWYXJpYW50Pzogc3RyaW5nO1xuICBmb250V2VpZ2h0PzogTnVtYmVyUHJvcDtcbiAgZm9udFN0cmV0Y2g/OiBzdHJpbmc7XG4gIGZvbnRTaXplPzogTnVtYmVyUHJvcDtcbiAgZm9udEZhbWlseT86IHN0cmluZztcbiAgdGV4dEFuY2hvcj86IHN0cmluZztcbiAgdGV4dERlY29yYXRpb24/OiBzdHJpbmc7XG4gIGxldHRlclNwYWNpbmc/OiBOdW1iZXJQcm9wO1xuICB3b3JkU3BhY2luZz86IE51bWJlclByb3A7XG4gIGtlcm5pbmc/OiBOdW1iZXJQcm9wO1xuICBmb250RmVhdHVyZVNldHRpbmdzPzogc3RyaW5nO1xuICBmb250VmFyaWFudExpZ2F0dXJlcz86IHN0cmluZztcbiAgZm9udFZhcmlhdGlvblNldHRpbmdzPzogc3RyaW5nO1xuICBmb250Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdEZvbnQocHJvcHM6IGZvbnRQcm9wcykge1xuICBjb25zdCB7XG4gICAgZm9udERhdGEsXG4gICAgZm9udFN0eWxlLFxuICAgIGZvbnRWYXJpYW50LFxuICAgIGZvbnRXZWlnaHQsXG4gICAgZm9udFN0cmV0Y2gsXG4gICAgZm9udFNpemUsXG4gICAgZm9udEZhbWlseSxcbiAgICB0ZXh0QW5jaG9yLFxuICAgIHRleHREZWNvcmF0aW9uLFxuICAgIGxldHRlclNwYWNpbmcsXG4gICAgd29yZFNwYWNpbmcsXG4gICAga2VybmluZyxcbiAgICBmb250RmVhdHVyZVNldHRpbmdzLFxuICAgIGZvbnRWYXJpYW50TGlnYXR1cmVzLFxuICAgIGZvbnRWYXJpYXRpb25TZXR0aW5ncyxcbiAgICBmb250LFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3Qgb3duZWRGb250ID0gcGlja05vdE5pbCh7XG4gICAgZm9udERhdGEsXG4gICAgZm9udFN0eWxlLFxuICAgIGZvbnRWYXJpYW50LFxuICAgIGZvbnRXZWlnaHQsXG4gICAgZm9udFN0cmV0Y2gsXG4gICAgZm9udFNpemUsXG4gICAgZm9udEZhbWlseTogZXh0cmFjdFNpbmdsZUZvbnRGYW1pbHkoZm9udEZhbWlseSksXG4gICAgdGV4dEFuY2hvcixcbiAgICB0ZXh0RGVjb3JhdGlvbixcbiAgICBsZXR0ZXJTcGFjaW5nLFxuICAgIHdvcmRTcGFjaW5nLFxuICAgIGtlcm5pbmcsXG4gICAgZm9udEZlYXR1cmVTZXR0aW5ncyxcbiAgICBmb250VmFyaWFudExpZ2F0dXJlcyxcbiAgICBmb250VmFyaWF0aW9uU2V0dGluZ3MsXG4gIH0pO1xuXG4gIGNvbnN0IGJhc2VGb250ID0gdHlwZW9mIGZvbnQgPT09ICdzdHJpbmcnID8gcGFyc2VGb250U3RyaW5nKGZvbnQpIDogZm9udDtcblxuICByZXR1cm4geyAuLi5iYXNlRm9udCwgLi4ub3duZWRGb250IH07XG59XG5cbmxldCBUU3BhbjogQ29tcG9uZW50VHlwZTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNldFRTcGFuKFRTcGFuSW1wbGVtZW50YXRpb246IENvbXBvbmVudFR5cGUpIHtcbiAgVFNwYW4gPSBUU3BhbkltcGxlbWVudGF0aW9uO1xufVxuXG5mdW5jdGlvbiBnZXRDaGlsZChjaGlsZDogdW5kZWZpbmVkIHwgc3RyaW5nIHwgbnVtYmVyIHwgQ29tcG9uZW50VHlwZSkge1xuICBpZiAodHlwZW9mIGNoaWxkID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY2hpbGQgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIDxUU3Bhbj57U3RyaW5nKGNoaWxkKX08L1RTcGFuPjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY2hpbGQ7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgVGV4dFByb3BzID0ge1xuICB4PzogTnVtYmVyQXJyYXk7XG4gIHk/OiBOdW1iZXJBcnJheTtcbiAgZHg/OiBOdW1iZXJBcnJheTtcbiAgZHk/OiBOdW1iZXJBcnJheTtcbiAgcm90YXRlPzogTnVtYmVyQXJyYXk7XG4gIGNoaWxkcmVuPzogc3RyaW5nIHwgbnVtYmVyIHwgKHN0cmluZyB8IG51bWJlciB8IENvbXBvbmVudFR5cGUpW107XG4gIGlubGluZVNpemU/OiBOdW1iZXJQcm9wO1xuICBiYXNlbGluZVNoaWZ0PzogTnVtYmVyUHJvcDtcbiAgdmVydGljYWxBbGlnbj86IE51bWJlclByb3A7XG4gIGFsaWdubWVudEJhc2VsaW5lPzogc3RyaW5nO1xufSAmIGZvbnRQcm9wcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZXh0cmFjdFRleHQocHJvcHM6IFRleHRQcm9wcywgY29udGFpbmVyOiBib29sZWFuKSB7XG4gIGNvbnN0IHtcbiAgICB4LFxuICAgIHksXG4gICAgZHgsXG4gICAgZHksXG4gICAgcm90YXRlLFxuICAgIGNoaWxkcmVuLFxuICAgIGlubGluZVNpemUsXG4gICAgYmFzZWxpbmVTaGlmdCxcbiAgICB2ZXJ0aWNhbEFsaWduLFxuICAgIGFsaWdubWVudEJhc2VsaW5lLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgdGV4dENoaWxkcmVuID1cbiAgICB0eXBlb2YgY2hpbGRyZW4gPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBjaGlsZHJlbiA9PT0gJ251bWJlcicgPyAoXG4gICAgICBjb250YWluZXIgPyAoXG4gICAgICAgIDxUU3Bhbj57U3RyaW5nKGNoaWxkcmVuKX08L1RTcGFuPlxuICAgICAgKSA6IG51bGxcbiAgICApIDogQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pID4gMSB8fCBBcnJheS5pc0FycmF5KGNoaWxkcmVuKSA/IChcbiAgICAgIENoaWxkcmVuLm1hcChjaGlsZHJlbiwgZ2V0Q2hpbGQpXG4gICAgKSA6IChcbiAgICAgIGNoaWxkcmVuXG4gICAgKTtcblxuICByZXR1cm4ge1xuICAgIGNvbnRlbnQ6IHRleHRDaGlsZHJlbiA9PT0gbnVsbCA/IFN0cmluZyhjaGlsZHJlbikgOiBudWxsLFxuICAgIGNoaWxkcmVuOiB0ZXh0Q2hpbGRyZW4sXG4gICAgaW5saW5lU2l6ZSxcbiAgICBiYXNlbGluZVNoaWZ0LFxuICAgIHZlcnRpY2FsQWxpZ24sXG4gICAgYWxpZ25tZW50QmFzZWxpbmUsXG4gICAgZm9udDogZXh0cmFjdEZvbnQocHJvcHMpLFxuICAgIHg6IGV4dHJhY3RMZW5ndGhMaXN0KHgpLFxuICAgIHk6IGV4dHJhY3RMZW5ndGhMaXN0KHkpLFxuICAgIGR4OiBleHRyYWN0TGVuZ3RoTGlzdChkeCksXG4gICAgZHk6IGV4dHJhY3RMZW5ndGhMaXN0KGR5KSxcbiAgICByb3RhdGU6IGV4dHJhY3RMZW5ndGhMaXN0KHJvdGF0ZSksXG4gIH07XG59XG4iXX0=