8cc5041271c6cb83b2e589b1c5ccb4cd
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = extractGradient;

var _react = _interopRequireWildcard(require("react"));

var _extractColor = _interopRequireDefault(require("./extractColor"));

var _extractOpacity = _interopRequireDefault(require("./extractOpacity"));

var _extractTransform = _interopRequireDefault(require("./extractTransform"));

var _units = _interopRequireDefault(require("../units"));

var percentReg = /^([+\-]?\d+(?:\.\d+)?(?:[eE][+\-]?\d+)?)(%?)$/;

function percentToFloat(percent) {
  if (typeof percent === 'number') {
    return percent;
  }

  if (typeof percent === 'object' && typeof percent.__getAnimatedValue === 'function') {
    return percent.__getAnimatedValue();
  }

  var matched = typeof percent === 'string' && percent.match(percentReg);

  if (!matched) {
    console.warn("\"" + percent + "\" is not a valid number or percentage string.");
    return 0;
  }

  return matched[2] ? +matched[1] / 100 : +matched[1];
}

var offsetComparator = function offsetComparator(object, other) {
  return object[0] - other[0];
};

function extractGradient(props, parent) {
  var id = props.id,
      children = props.children,
      gradientTransform = props.gradientTransform,
      transform = props.transform,
      gradientUnits = props.gradientUnits;

  if (!id) {
    return null;
  }

  var stops = [];
  var childArray = children ? _react.Children.map(children, function (child) {
    return _react.default.cloneElement(child, {
      parent: parent
    });
  }) : [];
  var l = childArray.length;

  for (var i = 0; i < l; i++) {
    var _childArray$i$props = childArray[i].props,
        offset = _childArray$i$props.offset,
        stopColor = _childArray$i$props.stopColor,
        stopOpacity = _childArray$i$props.stopOpacity;
    var offsetNumber = percentToFloat(offset || 0);
    var color = stopColor && (0, _extractColor.default)(stopColor);

    if (typeof color !== 'number' || isNaN(offsetNumber)) {
      console.warn("\"" + stopColor + "\" is not a valid color or \"" + offset + "\" is not a valid offset");
      continue;
    }

    var alpha = Math.round((0, _extractOpacity.default)(stopOpacity) * 255);
    stops.push([offsetNumber, color & 0x00ffffff | alpha << 24]);
  }

  stops.sort(offsetComparator);
  var gradient = [];
  var k = stops.length;

  for (var j = 0; j < k; j++) {
    var s = stops[j];
    gradient.push(s[0], s[1]);
  }

  return {
    name: id,
    gradient: gradient,
    children: childArray,
    gradientUnits: gradientUnits && _units.default[gradientUnits] || 0,
    gradientTransform: (0, _extractTransform.default)(gradientTransform || transform || props)
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dHJhY3RHcmFkaWVudC50cyJdLCJuYW1lcyI6WyJwZXJjZW50UmVnIiwicGVyY2VudCIsIm1hdGNoZWQiLCJjb25zb2xlIiwib2Zmc2V0Q29tcGFyYXRvciIsIm9iamVjdCIsIm90aGVyIiwiaWQiLCJjaGlsZHJlbiIsImdyYWRpZW50VHJhbnNmb3JtIiwidHJhbnNmb3JtIiwiZ3JhZGllbnRVbml0cyIsInByb3BzIiwic3RvcHMiLCJjaGlsZEFycmF5IiwiQ2hpbGRyZW4iLCJSZWFjdCIsInBhcmVudCIsImwiLCJpIiwib2Zmc2V0Iiwic3RvcENvbG9yIiwic3RvcE9wYWNpdHkiLCJvZmZzZXROdW1iZXIiLCJwZXJjZW50VG9GbG9hdCIsImNvbG9yIiwiaXNOYU4iLCJhbHBoYSIsIk1hdGgiLCJncmFkaWVudCIsImsiLCJqIiwicyIsIm5hbWUiLCJ1bml0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBRUEsSUFBQSxhQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLGtCQUFBLENBQUE7O0FBQ0EsSUFBQSxlQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLG9CQUFBLENBQUE7O0FBQ0EsSUFBQSxpQkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxzQkFBQSxDQUFBOztBQUVBLElBQUEsTUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxZQUFBLENBQUE7O0FBRUEsSUFBTUEsVUFBVSxHQUFoQiwrQ0FBQTs7QUFFQSxTQUFBLGNBQUEsQ0FBQSxPQUFBLEVBT1U7QUFDUixNQUFJLE9BQUEsT0FBQSxLQUFKLFFBQUEsRUFBaUM7QUFDL0IsV0FBQSxPQUFBO0FBRUY7O0FBQUEsTUFDRSxPQUFBLE9BQUEsS0FBQSxRQUFBLElBQ0EsT0FBT0MsT0FBTyxDQUFkLGtCQUFBLEtBRkYsVUFBQSxFQUdFO0FBQ0EsV0FBT0EsT0FBTyxDQUFkLGtCQUFPQSxFQUFQO0FBRUY7O0FB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QSxDQUFBQSxnQkFBQUE7QUFFQSxNQUFNZ0IsUUFBUSxHQUFkLEVBQUE7QUFDQSxNQUFNQyxDQUFDLEdBQUdqQixLQUFLLENBQWYsTUFBQTs7QUFDQSxPQUFLLElBQUlrQixDQUFDLEdBQVYsQ0FBQSxFQUFnQkEsQ0FBQyxHQUFqQixDQUFBLEVBQXVCQSxDQUF2QixFQUFBLEVBQTRCO0FBQzFCLFFBQU1DLENBQUMsR0FBR25CLEtBQUssQ0FBZixDQUFlLENBQWY7QUFDQWdCLElBQUFBLFFBQVEsQ0FBUkEsSUFBQUEsQ0FBY0csQ0FBQyxDQUFmSCxDQUFlLENBQWZBLEVBQW9CRyxDQUFDLENBQXJCSCxDQUFxQixDQUFyQkE7QUFHRjs7QUFBQSxTQUFPO0FBQ0xJLElBQUFBLElBQUksRUFEQyxFQUFBO0FBRUxKLElBQUFBLFFBQVEsRUFGSCxRQUFBO0FBR0xyQixJQUFBQSxRQUFRLEVBSEgsVUFBQTtBQUlMRyxJQUFBQSxhQUFhLEVBQUdBLGFBQWEsSUFBSXVCLE1BQUFBLENBQUFBLE9BQUFBLENBQWxCLGFBQWtCQSxDQUFqQnZCLElBSlgsQ0FBQTtBQUtMRixJQUFBQSxpQkFBaUIsRUFBRSxDQUFBLEdBQUEsaUJBQUEsQ0FBQSxPQUFBLEVBQ2pCQSxpQkFBaUIsSUFBakJBLFNBQUFBLElBTkosS0FLcUI7QUFMZCxHQUFQO0FBU0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ2hpbGRyZW4sIFJlYWN0RWxlbWVudCB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IGV4dHJhY3RDb2xvciBmcm9tICcuL2V4dHJhY3RDb2xvcic7XG5pbXBvcnQgZXh0cmFjdE9wYWNpdHkgZnJvbSAnLi9leHRyYWN0T3BhY2l0eSc7XG5pbXBvcnQgZXh0cmFjdFRyYW5zZm9ybSBmcm9tICcuL2V4dHJhY3RUcmFuc2Zvcm0nO1xuaW1wb3J0IHsgVHJhbnNmb3JtUHJvcHMgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB1bml0cyBmcm9tICcuLi91bml0cyc7XG5cbmNvbnN0IHBlcmNlbnRSZWcgPSAvXihbK1xcLV0/XFxkKyg/OlxcLlxcZCspPyg/OltlRV1bK1xcLV0/XFxkKyk/KSglPykkLztcblxuZnVuY3Rpb24gcGVyY2VudFRvRmxvYXQoXG4gIHBlcmNlbnQ6XG4gICAgfCBudW1iZXJcbiAgICB8IHN0cmluZ1xuICAgIHwge1xuICAgICAgICBfX2dldEFuaW1hdGVkVmFsdWU6ICgpID0+IG51bWJlcjtcbiAgICAgIH0sXG4pOiBudW1iZXIge1xuICBpZiAodHlwZW9mIHBlcmNlbnQgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIHBlcmNlbnQ7XG4gIH1cbiAgaWYgKFxuICAgIHR5cGVvZiBwZXJjZW50ID09PSAnb2JqZWN0JyAmJlxuICAgIHR5cGVvZiBwZXJjZW50Ll9fZ2V0QW5pbWF0ZWRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJ1xuICApIHtcbiAgICByZXR1cm4gcGVyY2VudC5fX2dldEFuaW1hdGVkVmFsdWUoKTtcbiAgfVxuICBjb25zdCBtYXRjaGVkID0gdHlwZW9mIHBlcmNlbnQgPT09ICdzdHJpbmcnICYmIHBlcmNlbnQubWF0Y2gocGVyY2VudFJlZyk7XG4gIGlmICghbWF0Y2hlZCkge1xuICAgIGNvbnNvbGUud2FybihgXCIke3BlcmNlbnR9XCIgaXMgbm90IGEgdmFsaWQgbnVtYmVyIG9yIHBlcmNlbnRhZ2Ugc3RyaW5nLmApO1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgcmV0dXJuIG1hdGNoZWRbMl0gPyArbWF0Y2hlZFsxXSAvIDEwMCA6ICttYXRjaGVkWzFdO1xufVxuXG5jb25zdCBvZmZzZXRDb21wYXJhdG9yID0gKG9iamVjdDogbnVtYmVyW10sIG90aGVyOiBudW1iZXJbXSkgPT5cbiAgb2JqZWN0WzBdIC0gb3RoZXJbMF07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGV4dHJhY3RHcmFkaWVudChcbiAgcHJvcHM6IHtcbiAgICBpZD86IHN0cmluZztcbiAgICBjaGlsZHJlbj86IFJlYWN0RWxlbWVudFtdO1xuICAgIHRyYW5zZm9ybT86IG51bWJlcltdIHwgc3RyaW5nIHwgVHJhbnNmb3JtUHJvcHM7XG4gICAgZ3JhZGllbnRUcmFuc2Zvcm0/OiBudW1iZXJbXSB8IHN0cmluZyB8IFRyYW5zZm9ybVByb3BzO1xuICAgIGdyYWRpZW50VW5pdHM/OiAnb2JqZWN0Qm91bmRpbmdCb3gnIHwgJ3VzZXJTcGFjZU9uVXNlJztcbiAgfSAmIFRyYW5zZm9ybVByb3BzLFxuICBwYXJlbnQ6IHt9LFxuKSB7XG4gIGNvbnN0IHsgaWQsIGNoaWxkcmVuLCBncmFkaWVudFRyYW5zZm9ybSwgdHJhbnNmb3JtLCBncmFkaWVudFVuaXRzIH0gPSBwcm9wcztcbiAgaWYgKCFpZCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3Qgc3RvcHMgPSBbXTtcbiAgY29uc3QgY2hpbGRBcnJheSA9IGNoaWxkcmVuXG4gICAgPyBDaGlsZHJlbi5tYXAoY2hpbGRyZW4sIGNoaWxkID0+XG4gICAgICAgIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZCwge1xuICAgICAgICAgIHBhcmVudCxcbiAgICAgICAgfSksXG4gICAgICApXG4gICAgOiBbXTtcbiAgY29uc3QgbCA9IGNoaWxkQXJyYXkubGVuZ3RoO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3BzOiB7IG9mZnNldCwgc3RvcENvbG9yLCBzdG9wT3BhY2l0eSB9LFxuICAgIH0gPSBjaGlsZEFycmF5W2ldO1xuICAgIGNvbnN0IG9mZnNldE51bWJlciA9IHBlcmNlbnRUb0Zsb2F0KG9mZnNldCB8fCAwKTtcbiAgICBjb25zdCBjb2xvciA9IHN0b3BDb2xvciAmJiBleHRyYWN0Q29sb3Ioc3RvcENvbG9yKTtcbiAgICBpZiAodHlwZW9mIGNvbG9yICE9PSAnbnVtYmVyJyB8fCBpc05hTihvZmZzZXROdW1iZXIpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBcIiR7c3RvcENvbG9yfVwiIGlzIG5vdCBhIHZhbGlkIGNvbG9yIG9yIFwiJHtvZmZzZXR9XCIgaXMgbm90IGEgdmFsaWQgb2Zmc2V0YCxcbiAgICAgICk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgYWxwaGEgPSBNYXRoLnJvdW5kKGV4dHJhY3RPcGFjaXR5KHN0b3BPcGFjaXR5KSAqIDI1NSk7XG4gICAgc3RvcHMucHVzaChbb2Zmc2V0TnVtYmVyLCAoY29sb3IgJiAweDAwZmZmZmZmKSB8IChhbHBoYSA8PCAyNCldKTtcbiAgfVxuICBzdG9wcy5zb3J0KG9mZnNldENvbXBhcmF0b3IpO1xuXG4gIGNvbnN0IGdyYWRpZW50ID0gW107XG4gIGNvbnN0IGsgPSBzdG9wcy5sZW5ndGg7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgazsgaisrKSB7XG4gICAgY29uc3QgcyA9IHN0b3BzW2pdO1xuICAgIGdyYWRpZW50LnB1c2goc1swXSwgc1sxXSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWU6IGlkLFxuICAgIGdyYWRpZW50LFxuICAgIGNoaWxkcmVuOiBjaGlsZEFycmF5LFxuICAgIGdyYWRpZW50VW5pdHM6IChncmFkaWVudFVuaXRzICYmIHVuaXRzW2dyYWRpZW50VW5pdHNdKSB8fCAwLFxuICAgIGdyYWRpZW50VHJhbnNmb3JtOiBleHRyYWN0VHJhbnNmb3JtKFxuICAgICAgZ3JhZGllbnRUcmFuc2Zvcm0gfHwgdHJhbnNmb3JtIHx8IHByb3BzLFxuICAgICksXG4gIH07XG59XG4iXX0=