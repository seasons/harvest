{"version":3,"sources":["setupJest.ts"],"names":["Enzyme","configure","adapter","Adapter","expect","extend","toMatchDiffSnapshot","diff","mockedModule","path","mockModuleName","jest","mock","originalConsoleError","console","error","message","includes","test","NativeModules","ARTakeCameraPhotoModule","errorCodes","cameraNotAvailable","imageMediaNotAvailable","cameraAccessDenied","saveFailed","ARCocoaConstantsModule","UIApplicationOpenSettingsURLString","AREnabled","ARSwitchBoardModule","presentNavigationViewController","fn","presentModalViewController","presentMediaPreviewController","presentArtworksSet","process","env","ALLOW_CONSOLE_LOGS","originalLoggers","warn","logToError","type","args","constructorOpt","explanation","chalk","white","gray","Error","msg","red","err","stack","replace","format","slice","captureStackTrace","beforeEach","done","types","forEach","handler","fail","spyOn","mockImplementation"],"mappings":"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","sourcesContent":["// re: https://github.com/facebook/react-native/issues/19955\n// and https://github.com/facebook/metro/pull/198\n//\n// import applyDecoratedDescriptor from \"@babel/runtime/helpers/applyDecoratedDescriptor\"\n// import initializerDefineProperty from \"@babel/runtime/helpers/initializerDefineProperty\"\n// declare var babelHelpers: any\n// Object.assign(babelHelpers, { applyDecoratedDescriptor, initializerDefineProperty })\n// import \"@babel/runtime\"\n\nimport chalk from \"chalk\"\nimport Enzyme from \"enzyme\"\nimport Adapter from \"enzyme-adapter-react-16\"\nimport expect from \"expect\"\nimport { format } from \"util\"\n\nimport \"lib/tests/renderUntil\"\nEnzyme.configure({ adapter: new Adapter() })\n\n// Waiting on https://github.com/thymikee/snapshot-diff/pull/17\nimport diff from \"snapshot-diff\"\nexpect.extend({ toMatchDiffSnapshot: (diff as any).toMatchDiffSnapshot })\n\nfunction mockedModule(path: string, mockModuleName: string) {\n  jest.mock(path, () => mockModuleName)\n}\n\nconst originalConsoleError = console.error\n\n// TODO: Remove once we're no longer using JSDOM for enzyme static rendering.\nconsole.error = (message?: any) => {\n  if (\n    typeof message === \"string\" &&\n    (message.includes(\"is using uppercase HTML. Always use lowercase HTML tags in React.\") ||\n      /Warning: React does not recognize the `\\w+` prop on a DOM element\\./.test(message) ||\n      /Warning: The tag <\\w+> is unrecognized in this browser\\./.test(message) ||\n      /Warning: Unknown event handler property `\\w+`\\./.test(message) ||\n      /Warning: Received `\\w+` for a non-boolean attribute `\\w+`\\./.test(message) ||\n      /Warning: [\\w\\s]+ has been extracted from react-native core/.test(message))\n  ) {\n    // NOOP\n  } else {\n    originalConsoleError(message)\n  }\n}\n\n// Native modules\nimport { NativeModules } from \"react-native\"\nNativeModules.ARTakeCameraPhotoModule = {\n  errorCodes: {\n    cameraNotAvailable: \"cameraNotAvailable\",\n    imageMediaNotAvailable: \"imageMediaNotAvailable\",\n    cameraAccessDenied: \"cameraAccessDenied\",\n    saveFailed: \"saveFailed\",\n  },\n}\nNativeModules.ARCocoaConstantsModule = {\n  UIApplicationOpenSettingsURLString: \"UIApplicationOpenSettingsURLString\",\n  AREnabled: true,\n}\nNativeModules.ARSwitchBoardModule = {\n  presentNavigationViewController: jest.fn(),\n  presentModalViewController: jest.fn(),\n  presentMediaPreviewController: jest.fn(),\n  presentArtworksSet: jest.fn(),\n}\n\ndeclare const process: any\n\nif (process.env.ALLOW_CONSOLE_LOGS !== \"true\") {\n  const originalLoggers = {\n    error: console.error,\n    warn: console.warn,\n  }\n\n  function logToError(type, args, constructorOpt: () => void) {\n    const explanation =\n      chalk.white(`Test failed due to \\`console.${type}(â€¦)\\` call.\\n`) +\n      chalk.gray(\"(Disable with ALLOW_CONSOLE_LOGS=true env variable.)\\n\\n\")\n    if (args[0] instanceof Error) {\n      const msg = explanation + chalk.red(args[0].message)\n      const err = new Error(msg)\n      err.stack = args[0].stack.replace(`Error: ${args[0].message}`, msg)\n      return err\n    } else if (\n      // Because we use react-dom in tests to render react-native components, a few warnings are being logged that we do\n      // not care for, so ignore these.\n      !args[0].includes(\"is using incorrect casing\") &&\n      !args[0].includes(\"is unrecognized in this browser\") &&\n      ![args[0].includes(\"React does not recognize the `testID` prop on a DOM element.\")]\n    ) {\n      const err = new Error(explanation + chalk.red(format(args[0], ...args.slice(1))))\n      ;(Error as any).captureStackTrace(err, constructorOpt)\n      return err\n    }\n    return null\n  }\n\n  beforeEach(done => {\n    const types: Array<\"error\" | \"warn\"> = [\"error\", \"warn\"]\n    types.forEach(type => {\n      // Don't spy on loggers that have been modified by the current test.\n      if (console[type] === originalLoggers[type]) {\n        const handler = (...args) => {\n          const error = logToError(type, args, handler)\n          if (error) {\n            done.fail(error)\n          }\n        }\n        jest.spyOn(console, type).mockImplementation(handler)\n      }\n    })\n    done() // it is important to call this here or every test will timeout\n  })\n}\n"]}