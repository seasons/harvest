de18ee3bd48a82e54207cc2287641adb
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.props2transform = props2transform;
exports.transformToMatrix = transformToMatrix;
exports.default = extractTransform;

var _Matrix2D = require("../Matrix2D");

var _transform = require("./transform");

function appendTransformProps(props) {
  var x = props.x,
      y = props.y,
      originX = props.originX,
      originY = props.originY,
      scaleX = props.scaleX,
      scaleY = props.scaleY,
      rotation = props.rotation,
      skewX = props.skewX,
      skewY = props.skewY;
  (0, _Matrix2D.appendTransform)(x + originX, y + originY, scaleX, scaleY, rotation, skewX, skewY, originX, originY);
}

function universal2axis(universal, axisX, axisY, defaultValue) {
  var x;
  var y;

  if (typeof universal === 'number') {
    x = y = universal;
  } else if (typeof universal === 'string') {
    var coords = universal.split(/\s*,\s*/);

    if (coords.length === 2) {
      x = +coords[0];
      y = +coords[1];
    } else if (coords.length === 1) {
      x = y = +coords[0];
    }
  } else if (Array.isArray(universal)) {
    if (universal.length === 2) {
      x = +universal[0];
      y = +universal[1];
    } else if (universal.length === 1) {
      x = y = +universal[0];
    }
  }

  axisX = +axisX;

  if (!isNaN(axisX)) {
    x = axisX;
  }

  axisY = +axisY;

  if (!isNaN(axisY)) {
    y = axisY;
  }

  return [x || defaultValue || 0, y || defaultValue || 0];
}

function props2transform(props) {
  var _props$rotation = props.rotation,
      rotation = _props$rotation === void 0 ? 0 : _props$rotation,
      translate = props.translate,
      translateX = props.translateX,
      translateY = props.translateY,
      origin = props.origin,
      originX = props.originX,
      originY = props.originY,
      scale = props.scale,
      scaleX = props.scaleX,
      scaleY = props.scaleY,
      skew = props.skew,
      skewX = props.skewX,
      skewY = props.skewY,
      x = props.x,
      y = props.y;

  if (Array.isArray(x) || Array.isArray(y)) {
    console.warn('Passing SvgLengthList to x or y attribute where SvgLength expected');
  }

  var tr = universal2axis(translate, translateX || (Array.isArray(x) ? x[0] : x), translateY || (Array.isArray(y) ? y[0] : y));
  var or = universal2axis(origin, originX, originY);
  var sc = universal2axis(scale, scaleX, scaleY, 1);
  var sk = universal2axis(skew, skewX, skewY);
  return {
    rotation: +rotation || 0,
    originX: or[0],
    originY: or[1],
    scaleX: sc[0],
    scaleY: sc[1],
    skewX: sk[0],
    skewY: sk[1],
    x: tr[0],
    y: tr[1]
  };
}

function transformToMatrix(props, transform) {
  (0, _Matrix2D.reset)();
  appendTransformProps(props);

  if (transform) {
    if (Array.isArray(transform)) {
      if (typeof transform[0] === 'number') {
        (0, _Matrix2D.append)(transform[0], transform[1], transform[2], transform[3], transform[4], transform[5]);
      }
    } else if (typeof transform === 'string') {
      try {
        var t = (0, _transform.parse)(transform);
        (0, _Matrix2D.append)(t[0], t[3], t[1], t[4], t[2], t[5]);
      } catch (e) {
        console.error(e);
      }
    } else {
      appendTransformProps(props2transform(transform));
    }
  }

  return (0, _Matrix2D.toArray)();
}

function extractTransform(props) {
  if (Array.isArray(props)) {
    return props;
  }

  if (typeof props === 'string') {
    try {
      var t = (0, _transform.parse)(props);
      return [t[0], t[3], t[1], t[4], t[2], t[5]];
    } catch (e) {
      console.error(e);
      return _Matrix2D.identity;
    }
  }

  return transformToMatrix(props2transform(props), props.transform);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dHJhY3RUcmFuc2Zvcm0udHMiXSwibmFtZXMiOlsieCIsInkiLCJvcmlnaW5YIiwib3JpZ2luWSIsInNjYWxlWCIsInNjYWxlWSIsInJvdGF0aW9uIiwic2tld1giLCJza2V3WSIsInByb3BzIiwiY29vcmRzIiwidW5pdmVyc2FsIiwiQXJyYXkiLCJheGlzWCIsImlzTmFOIiwiYXhpc1kiLCJ0cmFuc2xhdGUiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsIm9yaWdpbiIsInNjYWxlIiwic2tldyIsImNvbnNvbGUiLCJ0ciIsInVuaXZlcnNhbDJheGlzIiwib3IiLCJzYyIsInNrIiwiYXBwZW5kVHJhbnNmb3JtUHJvcHMiLCJ0cmFuc2Zvcm0iLCJ0IiwicHJvcHMydHJhbnNmb3JtIiwiaWRlbnRpdHkiLCJ0cmFuc2Zvcm1Ub01hdHJpeCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUEsU0FBQSxHQUFBLE9BQUEsZUFBQTs7QUFFQSxJQUFBLFVBQUEsR0FBQSxPQUFBLGVBQUE7O0FBR0EsU0FBQSxvQkFBQSxDQUFBLEtBQUEsRUFBdUQ7QUFBQSxNQUVuREEsQ0FGbUQsR0FXakRTLEtBWGlELENBQUEsQ0FBQTtBQUFBLE1BR25EUixDQUhtRCxHQVdqRFEsS0FYaUQsQ0FBQSxDQUFBO0FBQUEsTUFJbkRQLE9BSm1ELEdBV2pETyxLQVhpRCxDQUFBLE9BQUE7QUFBQSxNQUtuRE4sT0FMbUQsR0FXakRNLEtBWGlELENBQUEsT0FBQTtBQUFBLE1BTW5ETCxNQU5tRCxHQVdqREssS0FYaUQsQ0FBQSxNQUFBO0FBQUEsTUFPbkRKLE1BUG1ELEdBV2pESSxLQVhpRCxDQUFBLE1BQUE7QUFBQSxNQVFuREgsUUFSbUQsR0FXakRHLEtBWGlELENBQUEsUUFBQTtBQUFBLE1BU25ERixLQVRtRCxHQVdqREUsS0FYaUQsQ0FBQSxLQUFBO0FBQUEsTUFVbkRELEtBVm1ELEdBV2pEQyxLQVhpRCxDQUFBLEtBQUE7QUFZckQsR0FBQSxHQUFBLFNBQUEsQ0FBQSxlQUFB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O0FBRUg7QUFDRDs7QUFBQSxTQUFPQyxpQkFBaUIsQ0FBQ0YsZUFBZSxDQUFoQixLQUFnQixDQUFoQixFQUF5QnRCLEtBQUssQ0FBdEQsU0FBd0IsQ0FBeEI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFwcGVuZCwgYXBwZW5kVHJhbnNmb3JtLCBpZGVudGl0eSwgcmVzZXQsIHRvQXJyYXkgfSBmcm9tICcuLi9NYXRyaXgyRCc7XG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4vdHJhbnNmb3JtJztcbmltcG9ydCB7IE51bWJlclByb3AsIFRyYW5zZm9ybWVkUHJvcHMsIFRyYW5zZm9ybVByb3BzIH0gZnJvbSAnLi90eXBlcyc7XG5cbmZ1bmN0aW9uIGFwcGVuZFRyYW5zZm9ybVByb3BzKHByb3BzOiBUcmFuc2Zvcm1lZFByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICB4LFxuICAgIHksXG4gICAgb3JpZ2luWCxcbiAgICBvcmlnaW5ZLFxuICAgIHNjYWxlWCxcbiAgICBzY2FsZVksXG4gICAgcm90YXRpb24sXG4gICAgc2tld1gsXG4gICAgc2tld1ksXG4gIH0gPSBwcm9wcztcbiAgYXBwZW5kVHJhbnNmb3JtKFxuICAgIHggKyBvcmlnaW5YLFxuICAgIHkgKyBvcmlnaW5ZLFxuICAgIHNjYWxlWCxcbiAgICBzY2FsZVksXG4gICAgcm90YXRpb24sXG4gICAgc2tld1gsXG4gICAgc2tld1ksXG4gICAgb3JpZ2luWCxcbiAgICBvcmlnaW5ZLFxuICApO1xufVxuXG5mdW5jdGlvbiB1bml2ZXJzYWwyYXhpcyhcbiAgdW5pdmVyc2FsOiBOdW1iZXJQcm9wIHwgKE51bWJlclByb3ApW10gfCB1bmRlZmluZWQsXG4gIGF4aXNYOiBOdW1iZXJQcm9wIHwgdm9pZCxcbiAgYXhpc1k6IE51bWJlclByb3AgfCB2b2lkLFxuICBkZWZhdWx0VmFsdWU/OiBudW1iZXIsXG4pOiBbbnVtYmVyLCBudW1iZXJdIHtcbiAgbGV0IHg7XG4gIGxldCB5O1xuICBpZiAodHlwZW9mIHVuaXZlcnNhbCA9PT0gJ251bWJlcicpIHtcbiAgICB4ID0geSA9IHVuaXZlcnNhbDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgdW5pdmVyc2FsID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IGNvb3JkcyA9IHVuaXZlcnNhbC5zcGxpdCgvXFxzKixcXHMqLyk7XG4gICAgaWYgKGNvb3Jkcy5sZW5ndGggPT09IDIpIHtcbiAgICAgIHggPSArY29vcmRzWzBdO1xuICAgICAgeSA9ICtjb29yZHNbMV07XG4gICAgfSBlbHNlIGlmIChjb29yZHMubGVuZ3RoID09PSAxKSB7XG4gICAgICB4ID0geSA9ICtjb29yZHNbMF07XG4gICAgfVxuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodW5pdmVyc2FsKSkge1xuICAgIGlmICh1bml2ZXJzYWwubGVuZ3RoID09PSAyKSB7XG4gICAgICB4ID0gK3VuaXZlcnNhbFswXTtcbiAgICAgIHkgPSArdW5pdmVyc2FsWzFdO1xuICAgIH0gZWxzZSBpZiAodW5pdmVyc2FsLmxlbmd0aCA9PT0gMSkge1xuICAgICAgeCA9IHkgPSArdW5pdmVyc2FsWzBdO1xuICAgIH1cbiAgfVxuXG4gIGF4aXNYID0gK2F4aXNYO1xuICBpZiAoIWlzTmFOKGF4aXNYKSkge1xuICAgIHggPSBheGlzWDtcbiAgfVxuXG4gIGF4aXNZID0gK2F4aXNZO1xuICBpZiAoIWlzTmFOKGF4aXNZKSkge1xuICAgIHkgPSBheGlzWTtcbiAgfVxuXG4gIHJldHVybiBbeCB8fCBkZWZhdWx0VmFsdWUgfHwgMCwgeSB8fCBkZWZhdWx0VmFsdWUgfHwgMF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wczJ0cmFuc2Zvcm0ocHJvcHM6IFRyYW5zZm9ybVByb3BzKTogVHJhbnNmb3JtZWRQcm9wcyB7XG4gIGNvbnN0IHtcbiAgICByb3RhdGlvbiA9IDAsXG4gICAgdHJhbnNsYXRlLFxuICAgIHRyYW5zbGF0ZVgsXG4gICAgdHJhbnNsYXRlWSxcbiAgICBvcmlnaW4sXG4gICAgb3JpZ2luWCxcbiAgICBvcmlnaW5ZLFxuICAgIHNjYWxlLFxuICAgIHNjYWxlWCxcbiAgICBzY2FsZVksXG4gICAgc2tldyxcbiAgICBza2V3WCxcbiAgICBza2V3WSxcbiAgICB4LFxuICAgIHksXG4gIH0gPSBwcm9wcztcblxuICBpZiAoQXJyYXkuaXNBcnJheSh4KSB8fCBBcnJheS5pc0FycmF5KHkpKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ1Bhc3NpbmcgU3ZnTGVuZ3RoTGlzdCB0byB4IG9yIHkgYXR0cmlidXRlIHdoZXJlIFN2Z0xlbmd0aCBleHBlY3RlZCcsXG4gICAgKTtcbiAgfVxuICBjb25zdCB0ciA9IHVuaXZlcnNhbDJheGlzKFxuICAgIHRyYW5zbGF0ZSxcbiAgICB0cmFuc2xhdGVYIHx8IChBcnJheS5pc0FycmF5KHgpID8geFswXSA6IHgpLFxuICAgIHRyYW5zbGF0ZVkgfHwgKEFycmF5LmlzQXJyYXkoeSkgPyB5WzBdIDogeSksXG4gICk7XG4gIGNvbnN0IG9yID0gdW5pdmVyc2FsMmF4aXMob3JpZ2luLCBvcmlnaW5YLCBvcmlnaW5ZKTtcbiAgY29uc3Qgc2MgPSB1bml2ZXJzYWwyYXhpcyhzY2FsZSwgc2NhbGVYLCBzY2FsZVksIDEpO1xuICBjb25zdCBzayA9IHVuaXZlcnNhbDJheGlzKHNrZXcsIHNrZXdYLCBza2V3WSk7XG5cbiAgcmV0dXJuIHtcbiAgICByb3RhdGlvbjogK3JvdGF0aW9uIHx8IDAsXG4gICAgb3JpZ2luWDogb3JbMF0sXG4gICAgb3JpZ2luWTogb3JbMV0sXG4gICAgc2NhbGVYOiBzY1swXSxcbiAgICBzY2FsZVk6IHNjWzFdLFxuICAgIHNrZXdYOiBza1swXSxcbiAgICBza2V3WTogc2tbMV0sXG4gICAgeDogdHJbMF0sXG4gICAgeTogdHJbMV0sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1Ub01hdHJpeChcbiAgcHJvcHM6IFRyYW5zZm9ybWVkUHJvcHMsXG4gIHRyYW5zZm9ybTogbnVtYmVyW10gfCBzdHJpbmcgfCBUcmFuc2Zvcm1Qcm9wcyB8IHZvaWQgfCB1bmRlZmluZWQsXG4pOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl0ge1xuICByZXNldCgpO1xuICBhcHBlbmRUcmFuc2Zvcm1Qcm9wcyhwcm9wcyk7XG5cbiAgaWYgKHRyYW5zZm9ybSkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHRyYW5zZm9ybSkpIHtcbiAgICAgIGlmICh0eXBlb2YgdHJhbnNmb3JtWzBdID09PSAnbnVtYmVyJykge1xuICAgICAgICBhcHBlbmQoXG4gICAgICAgICAgdHJhbnNmb3JtWzBdLFxuICAgICAgICAgIHRyYW5zZm9ybVsxXSxcbiAgICAgICAgICB0cmFuc2Zvcm1bMl0sXG4gICAgICAgICAgdHJhbnNmb3JtWzNdLFxuICAgICAgICAgIHRyYW5zZm9ybVs0XSxcbiAgICAgICAgICB0cmFuc2Zvcm1bNV0sXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLyBub29wIGZvciByZWFjdC1uYXRpdmUgdHJhbnNmb3JtIGFycmF5cywgbGV0IGFuaW1hdGVkIGhhbmRsZSB0aGVtXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdHJhbnNmb3JtID09PSAnc3RyaW5nJykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdCA9IHBhcnNlKHRyYW5zZm9ybSk7XG4gICAgICAgIGFwcGVuZCh0WzBdLCB0WzNdLCB0WzFdLCB0WzRdLCB0WzJdLCB0WzVdKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXBwZW5kVHJhbnNmb3JtUHJvcHMocHJvcHMydHJhbnNmb3JtKHRyYW5zZm9ybSkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0b0FycmF5KCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGV4dHJhY3RUcmFuc2Zvcm0oXG4gIHByb3BzOiBudW1iZXJbXSB8IHN0cmluZyB8IFRyYW5zZm9ybVByb3BzLFxuKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHByb3BzKSkge1xuICAgIHJldHVybiBwcm9wcztcbiAgfVxuICBpZiAodHlwZW9mIHByb3BzID09PSAnc3RyaW5nJykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0ID0gcGFyc2UocHJvcHMpO1xuICAgICAgcmV0dXJuIFt0WzBdLCB0WzNdLCB0WzFdLCB0WzRdLCB0WzJdLCB0WzVdXTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgcmV0dXJuIGlkZW50aXR5O1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJhbnNmb3JtVG9NYXRyaXgocHJvcHMydHJhbnNmb3JtKHByb3BzKSwgcHJvcHMudHJhbnNmb3JtKTtcbn1cbiJdfQ==